package precompiled

import (
	"errors"
	"math/big"
	"strings"
	"web3_gui/chain/evm/precompiled/cloud"
	"web3_gui/chain/evm/precompiled/cross"

	"web3_gui/chain/config"
	"web3_gui/chain/db"
	"web3_gui/chain/evm"
	"web3_gui/chain/evm/abi"
	"web3_gui/chain/evm/common"
	"web3_gui/chain/evm/common/evmutils"
	"web3_gui/chain/evm/precompiled/ens"
	"web3_gui/chain/evm/vm"
	"web3_gui/chain/evm/vm/environment"
	"web3_gui/chain/evm/vm/opcodes"
	"web3_gui/chain/protos/go_protos"

	"github.com/golang/protobuf/proto"
	"web3_gui/keystore/adapter/crypto"
	"web3_gui/libp2parea/adapter/engine"
)

const (
	REWARD_CONTRACT_GAS = 12811
	//新版本带事件10w
	REWARD_RATE_ABI = `[{"constant":true,"inputs":[{"name":"start","type":"uint256"},{"name":"end","type":"uint256"}],"name":"getAllLight","outputs":[{"components":[{"name":"addr","type":"address"},{"name":"c","type":"address"},{"name":"vote","type":"uint256"},{"name":"score","type":"uint256"},{"name":"cname","type":"string"},{"name":"blockHeight","type":"uint256"},{"name":"name","type":"string"}],"name":"","type":"tuple[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_value","type":"uint256"}],"name":"withDrawC","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getLightTotal","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"maxLightCount","outputs":[{"name":"","type":"uint16"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"addr","type":"address"}],"name":"queryAllReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getCommunityRewardList","outputs":[{"components":[{"name":"addr","type":"address"},{"name":"wit","type":"address"},{"name":"vote","type":"uint256"},{"name":"name","type":"string"},{"name":"score","type":"uint256"},{"name":"blockHeight","type":"uint256"},{"name":"reward","type":"uint256"},{"name":"rate","type":"uint8"},{"name":"lightCount","type":"uint256"}],"name":"","type":"tuple[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"addr","type":"address"}],"name":"getWiteVote","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"allReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"allCReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"w","type":"address"}],"name":"getCommunityListByWit","outputs":[{"components":[{"name":"addr","type":"address"},{"name":"wit","type":"address"},{"name":"vote","type":"uint256"},{"name":"name","type":"string"},{"name":"score","type":"uint256"},{"name":"blockHeight","type":"uint256"}],"name":"","type":"tuple[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"rate","type":"uint8"}],"name":"setRate","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"transferOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"c","type":"uint16"},{"name":"l","type":"uint16"}],"name":"setRoleLimit","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getAllCommunity","outputs":[{"components":[{"name":"addr","type":"address"},{"name":"wit","type":"address"},{"name":"vote","type":"uint256"},{"name":"name","type":"string"},{"name":"score","type":"uint256"},{"name":"blockHeight","type":"uint256"}],"name":"","type":"tuple[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"lastVoteOp","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"witnessRewardPool","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"communityRewardPool","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_value","type":"uint256"}],"name":"withDrawW","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"l","type":"address"}],"name":"getWitByL","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"w","type":"address"},{"name":"rate","type":"uint8"},{"name":"name","type":"string"}],"name":"addCommunity","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"remainCReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"w","type":"address"}],"name":"getWitnessInfo","outputs":[{"components":[{"name":"addr","type":"address"},{"name":"wit","type":"address"},{"name":"rate","type":"uint8"},{"name":"reward","type":"uint256"},{"name":"remainReward","type":"uint256"},{"components":[{"name":"addr","type":"address"},{"name":"wit","type":"address"},{"name":"vote","type":"uint256"},{"name":"name","type":"string"},{"name":"score","type":"uint256"},{"name":"blockHeight","type":"uint256"},{"name":"reward","type":"uint256"},{"name":"rate","type":"uint8"},{"name":"lightCount","type":"uint256"}],"name":"communitys","type":"tuple[]"}],"name":"","type":"tuple"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"list","type":"address[]"}],"name":"getCommunityList","outputs":[{"components":[{"name":"addr","type":"address"},{"name":"wit","type":"address"},{"name":"vote","type":"uint256"},{"name":"name","type":"string"},{"name":"score","type":"uint256"},{"name":"blockHeight","type":"uint256"}],"name":"","type":"tuple[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_value","type":"uint256"}],"name":"withDrawL","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getRate","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"addr","type":"address"}],"name":"getAddrState","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"c","type":"address"}],"name":"addVote","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"addrRate","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"addr","type":"address"}],"name":"getRatio","outputs":[{"name":"","type":"uint32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getOwner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"lightMap","outputs":[{"name":"addr","type":"address"},{"name":"c","type":"address"},{"name":"vote","type":"uint256"},{"name":"blockHeight","type":"uint256"},{"name":"name","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"vote","type":"uint256"}],"name":"delVote","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"communityDistribute","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"delLight","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"maxCommunityCount","outputs":[{"name":"","type":"uint16"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"remainReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"lastRewardBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"c","type":"address"}],"name":"getWitByC","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"remainLReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"name","type":"string"}],"name":"addLight","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"allLReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"list","type":"address[]"},{"name":"index","type":"uint256"},{"name":"totalReward","type":"uint256"}],"name":"distribute","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"delCommunity","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"addr","type":"address"}],"name":"getCommVote","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"deposit","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"list","type":"address[]"}],"name":"getLightList","outputs":[{"components":[{"name":"addr","type":"address"},{"name":"c","type":"address"},{"name":"vote","type":"uint256"},{"name":"score","type":"uint256"},{"name":"cname","type":"string"},{"name":"blockHeight","type":"uint256"},{"name":"name","type":"string"}],"name":"","type":"tuple[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"remainWReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"c","type":"address"}],"name":"getLightListByC","outputs":[{"components":[{"name":"addr","type":"address"},{"name":"c","type":"address"},{"name":"vote","type":"uint256"},{"name":"score","type":"uint256"},{"name":"cname","type":"string"},{"name":"blockHeight","type":"uint256"},{"name":"name","type":"string"}],"name":"","type":"tuple[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"addrs","type":"address[]"}],"name":"getRateAndVoteByAddrs","outputs":[{"name":"","type":"uint8[]"},{"name":"","type":"uint256[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"allWReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getRoleTotal","outputs":[{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"into","type":"address"},{"indexed":true,"name":"from","type":"address"},{"indexed":false,"name":"reward","type":"uint256"},{"indexed":false,"name":"name","type":"string"},{"indexed":false,"name":"utype","type":"uint8"}],"name":"LogRewardHistory","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"addr","type":"address"},{"indexed":false,"name":"reward","type":"uint256"}],"name":"WithDrawReward","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"community","type":"address"},{"indexed":false,"name":"reward","type":"uint256"}],"name":"LogCommunityRewardPool","type":"event"}]`
	REWARD_RATE_BIN = `608060405260148054606461ffff199091161763ffff0000191662c800001790556000601555610258601655620186a0601a5534801561003e57600080fd5b50601c8054600160a060020a03191633179055615159806100606000396000f3006080604052600436106102665763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663021f67db811461026b5780630c0d831d146102a15780630fbcbeb3146102c35780630fc964e6146102e55780631000f62d1461030757806321a09b46146103275780632ceb9e7b1461034957806341eac22414610369578063447db0c314610389578063473f781f146103a95780634afe2f80146103d65780634fb2e45d146103f657806353a4f0c31461041657806356d2e56314610436578063582b1e231461044b57806359bdc1351461046b57806359fd379d1461048b5780635a9499e0146104ab5780635c99bc5b146104cb5780635d7871ba146104f857806360db14a71461050b57806361adc1021461052b578063636ed4c31461055857806364ab6c6914610578578063679aefce146105985780636a37e368146105ba5780636cea0e46146105da5780637486f6cd146105ed578063754b27071461060d578063893d20e81461063a5780638fbe78bb1461064f5780639351f4f21461068057806396a9fd72146106a05780639fe8326a146106b5578063a21814fd146106ca578063a498a0c4146106df578063a9f8d181146106ff578063af43bb0114610714578063bbff252e14610734578063c9fd650d14610754578063caf82b3f14610767578063d0558c3414610787578063d8593433146107a7578063dd7ae3b7146107bc578063f340fa01146107dc578063f817f07c146107fc578063f855477a1461081c578063f92443831461083c578063fa969dd11461085c578063fb7d87701461088a578063fe22ca14146108aa575b600080fd5b34801561027757600080fd5b5061028b6102863660046140f0565b6108cd565b6040516102989190614d6a565b60405180910390f35b3480156102ad57600080fd5b506102c16102bc3660046140d2565b6109e8565b005b3480156102cf57600080fd5b506102d8610ac2565b6040516102989190614f7d565b3480156102f157600080fd5b506102fa610ad4565b6040516102989190614f6f565b34801561031357600080fd5b506102d8610322366004613f49565b610ae4565b34801561033357600080fd5b5061033c610b03565b6040516102989190614d59565b34801561035557600080fd5b506102d8610364366004613f49565b610eb8565b34801561037557600080fd5b506102d8610384366004613f49565b610ed6565b34801561039557600080fd5b506102d86103a4366004613f49565b610ee8565b3480156103b557600080fd5b506103c96103c4366004613f49565b610efa565b6040516102989190614d48565b3480156103e257600080fd5b506102c16103f1366004614120565b610f4f565b34801561040257600080fd5b506102c1610411366004613f49565b610f99565b34801561042257600080fd5b506102c1610431366004614098565b610ffb565b34801561044257600080fd5b506103c9611052565b34801561045757600080fd5b506102d8610466366004613f49565b611071565b34801561047757600080fd5b506102d8610486366004613f49565b611083565b34801561049757600080fd5b506102d86104a6366004613f49565b611095565b3480156104b757600080fd5b506102c16104c63660046140d2565b6110a7565b3480156104d757600080fd5b506104eb6104e6366004613f49565b61113c565b6040516102989190614ce8565b6102c1610506366004613f6f565b611170565b34801561051757600080fd5b506102d8610526366004613f49565b61135e565b34801561053757600080fd5b5061054b610546366004613f49565b611370565b6040516102989190614f5e565b34801561056457600080fd5b506103c9610573366004613fd4565b611790565b34801561058457600080fd5b506102c16105933660046140d2565b611a60565b3480156105a457600080fd5b506105ad611af5565b6040516102989190615011565b3480156105c657600080fd5b506102d86105d5366004613f49565b611b0b565b6102c16105e8366004613f49565b611b68565b3480156105f957600080fd5b506105ad610608366004613f49565b611e46565b34801561061957600080fd5b5061062d610628366004613f49565b611e5b565b6040516102989190615003565b34801561064657600080fd5b506104eb612004565b34801561065b57600080fd5b5061066f61066a366004613f49565b612013565b604051610298959493929190614cf6565b34801561068c57600080fd5b506102c161069b3660046140d2565b6120db565b3480156106ac57600080fd5b506102c1612301565b3480156106c157600080fd5b506102c161238a565b3480156106d657600080fd5b506102fa612488565b3480156106eb57600080fd5b506102d86106fa366004613f49565b612492565b34801561070b57600080fd5b506102d86124a4565b34801561072057600080fd5b506104eb61072f366004613f49565b6124aa565b34801561074057600080fd5b506102d861074f366004613f49565b6124cb565b6102c1610762366004614063565b6124dd565b34801561077357600080fd5b506102d8610782366004613f49565b6125b5565b34801561079357600080fd5b506102c16107a2366004614009565b6125c7565b3480156107b357600080fd5b506102c1612642565b3480156107c857600080fd5b506102d86107d7366004613f49565b6127ca565b3480156107e857600080fd5b506102d86107f7366004613f49565b6127e8565b34801561080857600080fd5b5061028b610817366004613fd4565b6127fa565b34801561082857600080fd5b506102d8610837366004613f49565b612bb3565b34801561084857600080fd5b5061028b610857366004613f49565b612bc5565b34801561086857600080fd5b5061087c610877366004613fd4565b612c13565b604051610298929190614d7b565b34801561089657600080fd5b506102d86108a5366004613f49565b612d4c565b3480156108b657600080fd5b506108bf612d5e565b604051610298929190614fe8565b6060806000806108dd6004612d7d565b805190935086111561090d5760405160e560020a62461bcd02815260040161090490614e7e565b60405180910390fd5b825185111561091b57825194505b50845b8481101561097a5781838281518110151561093557fe5b6020908102919091018101518254600180820185556000948552929093209092018054600160a060020a031916600160a060020a03909316929092179091550161091e565b6109dc828054806020026020016040519081016040528092919081815260200182805480156109d257602002820191906000526020600020905b8154600160a060020a031681526001909101906020018083116109b4575b50505050506127fa565b93505b50505092915050565b336000908152600e6020526040902054811115610a1a5760405160e560020a62461bcd02815260040161090490614dfe565b3031811115610a3e5760405160e560020a62461bcd02815260040161090490614e8e565b336000818152600e6020526040808220805485900390555183156108fc0291849190818181858888f19350505050158015610a7d573d6000803e3d6000fd5b5033600160a060020a03167fc022fd2810d6ccb154ceb0f84df7a7627dac40716b0f9bb82c87d8598e696b3682604051610ab79190614f7d565b60405180910390a250565b6000610ace6004612e18565b90505b90565b60145462010000900461ffff1681565b600160a060020a0381166000908152600960205260409020545b919050565b60608060606000610b146002612d7d565b92508251604051908082528060200260200182016040528015610b5157816020015b610b3e613be5565b815260200190600190039081610b365790505b509150600090505b8251811015610eb15761012060405190810160405280600760008685815181101515610b8157fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060000160009054906101000a9004600160a060020a0316600160a060020a03168152602001600760008685815181101515610be257fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060010160009054906101000a9004600160a060020a0316600160a060020a03168152602001600760008685815181101515610c4357fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020600201548152602001600760008685815181101515610c8857fe5b602090810291909101810151600160a060020a031682528181019290925260409081016000206003018054825160026001831615610100026000190190921691909104601f810185900485028201850190935282815292909190830182828015610d335780601f10610d0857610100808354040283529160200191610d33565b820191906000526020600020905b815481529060010190602001808311610d1657829003601f168201915b50505050508152602001601260008685815181101515610d4f57fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020548152602001600760008685815181101515610d9157fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020600401548152602001600d60008685815181101515610dd657fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020548152602001601160008685815181101515610e1857fe5b6020908102909101810151600160a060020a031682528181019290925260400160009081205460ff16835286519290910191610e8f91600791889087908110610e5d57fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020600501612e18565b90528251839083908110610e9f57fe5b60209081029091010152600101610b59565b5092915050565b600160a060020a031660009081526008602052604090206001015490565b60096020526000908152604090205481565b600d6020526000908152604090205481565b600160a060020a03811660009081526008602052604081206003810180546060938493600201929091610f2f91600191613c47565b50905050610f3d6000612d7d565b9050610f4881611790565b9392505050565b606460ff82161115610f765760405160e560020a62461bcd02815260040161090490614f1e565b336000908152601160205260409020805460ff191660ff92909216919091179055565b601c54600160a060020a03163314610fc65760405160e560020a62461bcd02815260040161090490614f2e565b33600160a060020a0382161415610fdc57610ff8565b601c8054600160a060020a031916600160a060020a0383161790555b50565b601c54600160a060020a031633146110285760405160e560020a62461bcd02815260040161090490614f2e565b6014805461ffff928316620100000263ffff0000199490931661ffff199091161792909216179055565b60608061105f6002612d7d565b905061106a81611790565b91505b5090565b601b6020526000908152604090205481565b60176020526000908152604090205481565b60136020526000908152604090205481565b336000908152600c60205260409020548111156110d95760405160e560020a62461bcd02815260040161090490614dfe565b30318111156110fd5760405160e560020a62461bcd02815260040161090490614e8e565b336000818152600c6020526040808220805485900390555183156108fc0291849190818181858888f19350505050158015610a7d573d6000803e3d6000fd5b600160a060020a03908116600090815260066020908152604080832060019081015485168452600790925290912001541690565b606460ff831611156111975760405160e560020a62461bcd02815260040161090490614f1e565b33600090815260066020526040902054600160a060020a0316156111d05760405160e560020a62461bcd02815260040161090490614f4e565b33600090815260076020526040902060010154600160a060020a03161561120c5760405160e560020a62461bcd02815260040161090490614e4e565b60145461ffff1661121d6002612e18565b1061123d5760405160e560020a62461bcd02815260040161090490614dce565b336000818152600760209081526040808320600290810154600160a060020a0389168552600890935292206001810180549092019091556112869291019063ffffffff612e1f16565b15156112b757600160a060020a03831660009081526008602052604090206112b7906002013363ffffffff612e4116565b336000818152600760209081526040909120600181018054600160a060020a038816600160a060020a031991821617909155815416909217825582516113039260030191840190613c93565b503360008181526007602090815260408083204360049091015560118252808320805460ff191660ff88161790556012909152902034905561134790600290612e41565b5050336000908152601b6020526040902043905550565b600e6020526000908152604090205481565b611378613d0d565b600160a060020a038216600090815260116020908152604080832054600b835281842054600c845282852054600890945291842060038101805460ff909316959394936060938493919260029092019183916113d691600191613c47565b509050506113e46000612d7d565b9250825160405190808252806020026020018201604052801561142157816020015b61140e613be5565b8152602001906001900390816114065790505b509150600090505b825181101561174f576101206040519081016040528060076000868581518110151561145157fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060000160009054906101000a9004600160a060020a0316600160a060020a031681526020016007600086858151811015156114b257fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060010160009054906101000a9004600160a060020a0316600160a060020a0316815260200160076000868581518110151561151357fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060020154815260200160076000868581518110151561155857fe5b602090810291909101810151600160a060020a031682528181019290925260409081016000206003018054825160026001831615610100026000190190921691909104601f8101859004850282018501909352828152929091908301828280156116035780601f106115d857610100808354040283529160200191611603565b820191906000526020600020905b8154815290600101906020018083116115e657829003601f168201915b5050505050815260200160126000868581518110151561161f57fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002054815260200160076000868581518110151561166157fe5b90602001906020020151600160a060020a0316600160a060020a031681526020019081526020016000206004015481526020016009600086858151811015156116a657fe5b90602001906020020151600160a060020a0316600160a060020a031681526020019081526020016000205481526020016011600086858151811015156116e857fe5b6020908102909101810151600160a060020a031682528181019290925260400160009081205460ff1683528651929091019161172d91600791889087908110610e5d57fe5b9052825183908390811061173d57fe5b60209081029091010152600101611429565b506040805160c081018252600160a060020a03909816808952602089015260ff90951694870194909452506060850191909152608084015260a08301525090565b606080600083516040519080825280602002602001820160405280156117d057816020015b6117bd613d59565b8152602001906001900390816117b55790505b509150600090505b8351811015610eb15760c0604051908101604052806007600087858151811015156117ff57fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060000160009054906101000a9004600160a060020a0316600160a060020a0316815260200160076000878581518110151561186057fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060010160009054906101000a9004600160a060020a0316600160a060020a031681526020016007600087858151811015156118c157fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060020154815260200160076000878581518110151561190657fe5b602090810291909101810151600160a060020a031682528181019290925260409081016000206003018054825160026001831615610100026000190190921691909104601f8101859004850282018501909352828152929091908301828280156119b15780601f10611986576101008083540402835291602001916119b1565b820191906000526020600020905b81548152906001019060200180831161199457829003601f168201915b505050505081526020016012600087858151811015156119cd57fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020548152602001600760008785815181101515611a0f57fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020600401548152508282815181101515611a4e57fe5b602090810290910101526001016117d8565b33600090815260106020526040902054811115611a925760405160e560020a62461bcd02815260040161090490614dfe565b3031811115611ab65760405160e560020a62461bcd02815260040161090490614e8e565b33600081815260106020526040808220805485900390555183156108fc0291849190818181858888f19350505050158015610a7d573d6000803e3d6000fd5b3360009081526011602052604090205460ff1690565b600160a060020a0381811660009081526006602052604081205490911615611b3557506003610afe565b600160a060020a038281166000908152600760205260409020600101541615611b6057506002610afe565b506004919050565b33600090815260066020526040812054600160a060020a03161515611ba25760405160e560020a62461bcd02815260040161090490614eee565b33600090815260076020526040902060010154600160a060020a031615611bde5760405160e560020a62461bcd02815260040161090490614e0e565b600160a060020a03828116600090815260076020526040902060010154161515611c1d5760405160e560020a62461bcd02815260040161090490614ede565b33600090815260066020526040902060010154600160a060020a03161580611c62575033600090815260066020526040902060010154600160a060020a038381169116145b1515611c835760405160e560020a62461bcd02815260040161090490614e1e565b600160a060020a0382166000908152600760205260409020611cae906005013363ffffffff612e1f16565b158015611cec5750601454600160a060020a03831660009081526007602052604090206201000090910461ffff1690611ce990600501612e18565b10155b15611d0c5760405160e560020a62461bcd02815260040161090490614dae565b611d1582612edc565b600160a060020a038216600090815260076020526040902060028101805434019055611d4a906005013363ffffffff612e1f16565b1515611d7b57600160a060020a0382166000908152600760205260409020611d7b906005013363ffffffff612e4116565b5033600090815260066020908152604080832060018082018054600160a060020a031916600160a060020a038881169182179092556002909301805434019055918552600790935292200154168015611e2057600160a060020a0381166000908152600860205260409020611df9906002018363ffffffff612e1f16565b15611e2057600160a060020a03811660009081526008602052604090206001018054340190555b5050336000908152601260209081526040808320805434019055601b9091529020439055565b60116020526000908152604090205460ff1681565b600160a060020a038181166000908152600660205260408120600101549091161580611ea25750600160a060020a0382811660009081526007602052604090206001015416155b1515611ec35760405160e560020a62461bcd02815260040161090490614f3e565b600160a060020a038281166000908152600660205260409020600101541615611f6257600160a060020a0382166000908152600660205260409020600201541515611f1057506000610afe565b600160a060020a038083166000818152600660208181526040808420600181015490961684526007825283206002908101549490935252909101546305f5e10002811515611f5a57fe5b049050610afe565b600160a060020a038281166000908152600760205260409020600101541615611ffc57600160a060020a0382166000908152600760205260409020600201541515611faf57506000610afe565b600160a060020a038083166000818152600760208181526040808420600180820154909716855260088352908420909501549390925290526002909101546305f5e10002811515611f5a57fe5b506000919050565b601c54600160a060020a031690565b600660209081526000918252604091829020805460018083015460028085015460038601546004870180548a516101009782161597909702600019011693909304601f8101899004890286018901909952888552600160a060020a0395861698959093169690959294929392908301828280156120d15780601f106120a6576101008083540402835291602001916120d1565b820191906000526020600020905b8154815290600101906020018083116120b457829003601f168201915b5050505050905085565b33600090815260066020526040812060020154819081908411156121145760405160e560020a62461bcd02815260040161090490614efe565b33600090815260066020526040902060010154600160a060020a031692508215156121545760405160e560020a62461bcd02815260040161090490614e9e565b431561219657336000908152601b6020526040902054601a54439190910392508210156121965760405160e560020a62461bcd02815260040161090490614e5e565b600160a060020a038316156122fb576121ae83612edc565b600160a060020a03831660009081526007602090815260408083206002908101805489900390553384526006909252909120015484141561223557600160a060020a0383166000908152600760205260409020612214906005013363ffffffff6132f616565b3360009081526006602052604090206001018054600160a060020a03191690555b600160a060020a0383811660009081526007602052604090206001015416156122945750600160a060020a0380831660009081526007602090815260408083206001908101549094168084526008909252909120909101805485900390555b336000818152601260209081526040808320805489900390556006909152808220600201805488900390555186156108fc0291879190818181858888f193505050501580156122e7573d6000803e3d6000fd5b50336000908152601b602052604090204390555b50505050565b33600081815260076020526040902060010154600160a060020a031615156123815733600090815260066020526040902060010154600160a060020a031615612366575033600090815260066020526040902060010154600160a060020a0316612381565b60405160e560020a62461bcd02815260040161090490614e3e565b610ff881612edc565b33600090815260066020526040812060020154156123bd5760405160e560020a62461bcd02815260040161090490614e2e565b33600090815260066020526040902054600160a060020a031615156123f75760405160e560020a62461bcd02815260040161090490614eae565b33600090815260066020526040902054600160a060020a031615610ff8575033600081815260126020908152604080832080549084905560069092529091208054600160a060020a0319169055906124579060049063ffffffff6132f616565b604051339082156108fc029083906000818181858888f19350505050158015612484573d6000803e3d6000fd5b5050565b60145461ffff1681565b600a6020526000908152604090205481565b60155481565b600160a060020a039081166000908152600760205260409020600101541690565b60106020526000908152604090205481565b33600090815260076020526040902060010154600160a060020a0316156125195760405160e560020a62461bcd02815260040161090490614e0e565b33600090815260066020526040902054600160a060020a0316156125525760405160e560020a62461bcd02815260040161090490614e6e565b3360008181526006602090815260409091208054600160a060020a0319169092178255436003830155825161258d9260040191840190613c93565b50336000818152601260205260409020805434019055610ff89060049063ffffffff612e4116565b600f6020526000908152604090205481565b6000821180156125d8575060008351115b80156125e45750600081115b15156126055760405160e560020a62461bcd02815260040161090490614f0e565b6126108383836133e8565b6015544311158061262657506016546015544303105b156126305761263d565b61263861366f565b436015555b505050565b3360009081526007602052604081206001015481908190600160a060020a031615156126835760405160e560020a62461bcd02815260040161090490614dde565b43156126c557336000908152601b6020526040902054601a54439190910393508310156126c55760405160e560020a62461bcd02815260040161090490614ece565b33600090815260076020526040902060010154600160a060020a03161561263d57336000818152600760209081526040808320600180820154600292830154600160a060020a03909116808752600890955292909420938401805492909203909155909450612736929101906132f6565b503360008181526007602090815260408083206001018054600160a060020a0319169055601290915281208054919055906127799060029063ffffffff6132f616565b604051339082156108fc029083906000818181858888f193505050501580156127a6573d6000803e3d6000fd5b506127b033612edc565b336000908152601260205260409020805434019055505050565b600160a060020a031660009081526007602052604090206002015490565b60126020526000908152604090205481565b6060806000835160405190808252806020026020018201604052801561283a57816020015b612827613da2565b81526020019060019003908161281f5790505b509150600090505b8351811015610eb15760e06040519081016040528060066000878581518110151561286957fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060000160009054906101000a9004600160a060020a0316600160a060020a031681526020016006600087858151811015156128ca57fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060010160009054906101000a9004600160a060020a0316600160a060020a0316815260200160066000878581518110151561292b57fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060020154815260200160126000878581518110151561297057fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020548152602001600760006006600089878151811015156129b657fe5b6020908102909101810151600160a060020a039081168352828201939093526040918201600090812060019081015490941685528482019590955292810190932060030180548451601f60026000199584161561010002959095019092169390930490810184900484028301840190945283825290929091830182828015612a7f5780601f10612a5457610100808354040283529160200191612a7f565b820191906000526020600020905b815481529060010190602001808311612a6257829003601f168201915b50505050508152602001600660008785815181101515612a9b57fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020600301548152602001600660008785815181101515612ae057fe5b602090810291909101810151600160a060020a031682528181019290925260409081016000206004018054825160026001831615610100026000190190921691909104601f810185900485028201850190935282815292909190830182828015612b8b5780601f10612b6057610100808354040283529160200191612b8b565b820191906000526020600020905b815481529060010190602001808311612b6e57829003601f168201915b50505050508152508282815181101515612ba157fe5b60209081029091010152600101612842565b600c6020526000908152604090205481565b600160a060020a03811660009081526007602052604081206006810180546060938493600501929091612bfa91600191613c47565b50905050612c086000612d7d565b9050610f48816127fa565b60608060608060008551604051908082528060200260200182016040528015612c46578160200160208202803883390190505b5092508551604051908082528060200260200182016040528015612c74578160200160208202803883390190505b509150600090505b8551811015612d4157601160008783815181101515612c9757fe5b6020908102909101810151600160a060020a0316825281019190915260400160002054835160ff90911690849083908110612cce57fe5b60ff9092166020928302909101909101528551600890600090889084908110612cf357fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020600101548282815181101515612d2f57fe5b60209081029091010152600101612c7c565b509094909350915050565b600b6020526000908152604090205481565b600080612d6b6002612e18565b612d756004612e18565b915091509091565b60608060008360010180549050604051908082528060200260200182016040528015612db3578160200160208202803883390190505b5091505b6001840154811015610eb15760018401805482908110612dd357fe5b6000918252602090912001548251600160a060020a0390911690839083908110612df957fe5b600160a060020a03909216602092830290910190910152600101612db7565b6001015490565b600160a060020a03811660009081526020839052604090205415155b92915050565b600160a060020a0381161515612e6c5760405160e560020a62461bcd02815260040161090490614ebe565b612e768282612e1f565b15612e965760405160e560020a62461bcd02815260040161090490614dbe565b600180830180549182018155600081815260208082209093018054600160a060020a03909516600160a060020a0319909516851790559054928152929052604090912055565b600160a060020a038116600090815260136020526040812054819081906060908290819081901515612f0d576132ec565b600160a060020a03881660008181526013602052604080822080549083905590519099507f02cba861472fe08dca0820f37bb0d7194b85309abefa8ac3f04733b987ce8afc91612f5c91614da0565b60405180910390a2600160a060020a03881660009081526011602052604090205460649060ff168802049550600086111561323857600160a060020a038816600090815260076020526040812060068101805489985060059092019291612fc591600191613c47565b50905050612fd36000612d7d565b9350600092505b83518310156132385760006130058585815181101515612ff657fe5b90602001906020020151611e5b565b63ffffffff16111561322d576305f5e1006130278585815181101515612ff657fe5b63ffffffff16870281151561303857fe5b04915081850394508160096000868681518110151561305357fe5b90602001906020020151600160a060020a0316600160a060020a031681526020019081526020016000206000828254019250508190555081600a6000868681518110151561309d57fe5b90602001906020020151600160a060020a0316600160a060020a031681526020019081526020016000206000828254019250508190555081600f600086868151811015156130e757fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020600082825401925050819055508160106000868681518110151561313157fe5b90602001906020020151600160a060020a0316600160a060020a031681526020019081526020016000206000828254019250508190555087600160a060020a0316848481518110151561318057fe5b90602001906020020151600160a060020a03167f900928d4a48773c713a00e26efa83f1f9fe5a1e65bb937e6d8773daf54112983846006600089898151811015156131c757fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020600401600360405161320593929190614f8b565b60405180910390a361322d848481518110151561321e57fe5b90602001906020020151613994565b600190920191612fda565b50848603840160008111156132ec57600160a060020a038089166000818152600960209081526040808320805487019055600a8252808320805487019055600d8252808320805487019055600e82528083208054870190556007909152908190206001810154915191909316927f900928d4a48773c713a00e26efa83f1f9fe5a1e65bb937e6d8773daf54112983916132db918691600390910190600290614f8b565b60405180910390a36132ec88613a6a565b5050505050505050565b60008060006133058585612e1f565b15156133265760405160e560020a62461bcd02815260040161090490614dee565b600160a060020a03841660009081526020869052604090205460018601805460001992830195509182019350908390811061335d57fe5b600091825260209091200154600186018054600160a060020a03909216925082918590811061338857fe5b60009182526020808320919091018054600160a060020a031916600160a060020a03948516179055838316825287905260408082206001878101909155928716825281205585018054906133e0906000198301613df2565b505050505050565b60008080808080808080806064601e8c02049950898b0398508c518a81151561340d57fe5b04975060009650600095505b8c5186101561347f578b861061342e5761347f565b600860008e8881518110151561344057fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060010154870196508580600101965050613419565b60009450861515613499578b8981151561349557fe5b0494505b60009350600192505b8c518310156135c0578791508b83101561352057600087111561351b57613509600860008f868151811015156134d457fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060010154888e613afa565b90506305f5e100898202049450928401925b908401905b6135498d8481518110151561353157fe5b6020908102909101015160189063ffffffff612e1f16565b1515613578576135788d8481518110151561356057fe5b6020908102909101015160189063ffffffff612e4116565b81601760008f8681518110151561358b57fe5b6020908102909101810151600160a060020a0316825281019190915260400160002080549091019055600192909201916134a2565b8c518a8115156135cc57fe5b068801915060008711156135e657838903820191506135f9565b8b898115156135f157fe5b068501820191505b61360b8d600081518110151561353157fe5b1515613623576136238d600081518110151561356057fe5b81601760008f600081518110151561363757fe5b6020908102909101810151600160a060020a031682528101919091526040016000208054909101905550505050505050505050505050565b6000806000806000606060008060006136886018612e18565b151561369357613989565b600061369f6018612e18565b1115613989576136c460016136b46018612e18565b601891900363ffffffff613b2616565b98506136d760188a63ffffffff6132f616565b600160a060020a03891660009081526017602052604090205415156136fb57613693565b600160a060020a0389166000908152601760209081526040808320805490849055601190925282205490995090975060ff16871080156137545750600160a060020a038916600090815260086020526040812060010154115b1561377e57600160a060020a03891660009081526011602052604090205460649060ff1689020496505b6000955060008711156138e757600160a060020a038916600090815260086020526040902087965060020194506137b485612d7d565b9350600092505b83518310156138e7578515156137d0576138e7565b6305f5e1006137e68585815181101515612ff657fe5b63ffffffff1688028115156137f757fe5b049150811515613806576138dc565b81860395508160136000868681518110151561381e57fe5b6020908102909101810151600160a060020a0316825281019190915260400160002080549091019055835184908490811061385557fe5b90602001906020020151600160a060020a03167f02cba861472fe08dca0820f37bb0d7194b85309abefa8ac3f04733b987ce8afc60136000878781518110151561389b57fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020546040516138d39190614f7d565b60405180910390a25b6001909201916137bb565b508587038501600081111561398457600160a060020a0389166000818152600960209081526040808320805486019055600a8252808320805486019055600b8252808320805486019055600c909152808220805485019055519091907f900928d4a48773c713a00e26efa83f1f9fe5a1e65bb937e6d8773daf5411298390613973908590600190614fba565b60405180910390a361398489613b55565b613693565b505050505050505050565b600160a060020a038116600090815260106020526040812054811080156139d45750600160a060020a038216600090815260106020526040902054303110155b156124845750600160a060020a038116600081815260106020526040808220805490839055905190929183156108fc02918491818181858888f19350505050158015613a24573d6000803e3d6000fd5b5081600160a060020a03167fc022fd2810d6ccb154ceb0f84df7a7627dac40716b0f9bb82c87d8598e696b3682604051613a5e9190614f7d565b60405180910390a25050565b600160a060020a0381166000908152600e602052604081205481108015613aaa5750600160a060020a0382166000908152600e6020526040902054303110155b156124845750600160a060020a0381166000818152600e6020526040808220805490839055905190929183156108fc02918491818181858888f19350505050158015613a24573d6000803e3d6000fd5b60006305f5e1006509184e72a00083810285018682018302811515613b1b57fe5b049695505050505050565b60008260010182815481101515613b3957fe5b600091825260209091200154600160a060020a03169392505050565b600160a060020a0381166000908152600c602052604081205481108015613b955750600160a060020a0382166000908152600c6020526040902054303110155b156124845750600160a060020a0381166000818152600c6020526040808220805490839055905190929183156108fc02918491818181858888f19350505050158015613a24573d6000803e3d6000fd5b610120604051908101604052806000600160a060020a031681526020016000600160a060020a031681526020016000815260200160608152602001600081526020016000815260200160008152602001600060ff168152602001600081525090565b828054828255906000526020600020908101928215613c875760005260206000209182015b82811115613c87578254825591600101919060010190613c6c565b5061106d929150613e16565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10613cd457805160ff1916838001178555613d01565b82800160010185558215613d01579182015b82811115613d01578251825591602001919060010190613ce6565b5061106d929150613e3a565b60c0604051908101604052806000600160a060020a031681526020016000600160a060020a03168152602001600060ff1681526020016000815260200160008152602001606081525090565b60c0604051908101604052806000600160a060020a031681526020016000600160a060020a03168152602001600081526020016060815260200160008152602001600081525090565b60e0604051908101604052806000600160a060020a031681526020016000600160a060020a0316815260200160008152602001600081526020016060815260200160008152602001606081525090565b81548183558181111561263d5760008381526020902061263d918101908301613e3a565b610ad191905b8082111561106d578054600160a060020a0319168155600101613e1c565b610ad191905b8082111561106d5760008155600101613e40565b6000610f4882356150a5565b6000601f82018313613e7157600080fd5b8135613e84613e7f82615046565b61501f565b91508181835260208401935060208101905083856020840282011115613ea957600080fd5b60005b83811015613ed55781613ebf8882613e54565b8452506020928301929190910190600101613eac565b5050505092915050565b6000601f82018313613ef057600080fd5b8135613efe613e7f82615067565b91508082526020830160208301858383011115613f1a57600080fd5b6109df8382846150dd565b6000610f4882356150b1565b6000610f488235610ad1565b6000610f4882356150c1565b600060208284031215613f5b57600080fd5b6000613f678484613e54565b949350505050565b600080600060608486031215613f8457600080fd5b6000613f908686613e54565b9350506020613fa186828701613f3d565b925050604084013567ffffffffffffffff811115613fbe57600080fd5b613fca86828701613edf565b9150509250925092565b600060208284031215613fe657600080fd5b813567ffffffffffffffff811115613ffd57600080fd5b613f6784828501613e60565b60008060006060848603121561401e57600080fd5b833567ffffffffffffffff81111561403557600080fd5b61404186828701613e60565b935050602061405286828701613f31565b9250506040613fca86828701613f31565b60006020828403121561407557600080fd5b813567ffffffffffffffff81111561408c57600080fd5b613f6784828501613edf565b600080604083850312156140ab57600080fd5b60006140b78585613f25565b92505060206140c885828601613f25565b9150509250929050565b6000602082840312156140e457600080fd5b6000613f678484613f31565b6000806040838503121561410357600080fd5b600061410f8585613f31565b92505060206140c885828601613f31565b60006020828403121561413257600080fd5b6000613f678484613f3d565b614147816150a5565b82525050565b6000614158826150a1565b808452602084019350836020820285016141718561508f565b60005b848110156141a857838303885261418c838351614a79565b92506141978261508f565b602098909801979150600101614174565b50909695505050505050565b60006141bf826150a1565b808452602084019350836020820285016141d88561508f565b60005b848110156141a85783830388526141f3838351614afb565b92506141fe8261508f565b6020989098019791506001016141db565b600061421a826150a1565b808452602084019350836020820285016142338561508f565b60005b848110156141a857838303885261424e838351614afb565b92506142598261508f565b602098909801979150600101614236565b6000614275826150a1565b8084526020840193508360208202850161428e8561508f565b60005b848110156141a85783830388526142a9838351614bb1565b92506142b48261508f565b602098909801979150600101614291565b60006142d0826150a1565b8084526020840193506142e28361508f565b60005b82811015614312576142f8868351614ccd565b6143018261508f565b6020969096019591506001016142e5565b5093949350505050565b6000614327826150a1565b8084526020840193506143398361508f565b60005b828110156143125761434f868351614cdf565b6143588261508f565b60209690960195915060010161433c565b614147816150c7565b614147816150d2565b6000614386826150a1565b80845261439a8160208601602086016150e9565b6143a381615115565b9093016020019392505050565b6000815460018116600081146143cd57600181146143eb57614427565b60028204607f16855260ff1982166020860152604085019250614427565b6002820480865260208601955061440185615095565b60005b8281101561442057815488820152600190910190602001614404565b8701945050505b505092915050565b601481527f6c69676874206c696d6974206f766572666c6f77000000000000000000000000602082015260400190565b602f81527f4c6962416464726573735365743a2076616c756520616c72656164792065786960208201527f73747320696e20746865207365742e0000000000000000000000000000000000604082015260600190565b601881527f636f6d6d756e697479206c696d6974206f766572666c6f770000000000000000602082015260400190565b601981527f61646472657373206d75737420626520636f6d6d756e69747900000000000000602082015260400190565b602381527f4c6962416464726573735365743a2076616c756520646f65736e27742065786960208201527f73742e0000000000000000000000000000000000000000000000000000000000604082015260600190565b602f81527f616d6f756e74206d757374206265206c657373206f7220657175616c20796f7560208201527f722072656d61696e207265776172640000000000000000000000000000000000604082015260600190565b601481527f6164647265737320697320636f6d6d756e697479000000000000000000000000602082015260400190565b602981527f63616e6e6f7420766f746520666f7220206d756c7469706c6520636f6d6d756e60208201527f697479206e6f6465730000000000000000000000000000000000000000000000604082015260600190565b601781527f61646472657373206d757374206265206e6f20766f7465000000000000000000602082015260400190565b602d81527f646973747269627574652061646472657373206d75737420626520636f6d6d7560208201527f6e697479206f72206c6967687400000000000000000000000000000000000000604082015260600190565b601581527f61646472657373206861732061207769746e6573730000000000000000000000602082015260400190565b601581527f63616e63656c20766f746520746f6f206f6674656e0000000000000000000000602082015260400190565b601781527f6164647265737320616c72656164792061206c69676874000000000000000000602082015260400190565b601081527f737461727420697320746f6f2062696700000000000000000000000000000000602082015260400190565b601181527f616d6f756e7420697320696c6c6567616c000000000000000000000000000000602082015260400190565b601f81527f61646472657373206d7573742068617320766f746520636f6d6d756e69747900602082015260400190565b601581527f61646472657373206d757374206265206c696768740000000000000000000000602082015260400190565b602181527f4c6962416464726573735365743a2076616c75652063616e277420626520307860208201527f3000000000000000000000000000000000000000000000000000000000000000604082015260600190565b601a81527f63616e63656c20636f6d6d756e69747920746f6f206f6674656e000000000000602082015260400190565b601e81527f7461726765742061646472657373206e6f74206120636f6d6d756e6974790000602082015260400190565b601881527f61646472657373206d757374206265206973206c696768740000000000000000602082015260400190565b602281527f63616e63656c20766f7465206d757374206265206c65737320796f757220766f60208201527f7465000000000000000000000000000000000000000000000000000000000000604082015260600190565b600f81527f706172616d732069732077726f6e670000000000000000000000000000000000602082015260400190565b601281527f726174652073657474696e67206572726f720000000000000000000000000000602082015260400190565b6000815260200190565b601181527f617574686f7269736564206661696c6564000000000000000000000000000000602082015260400190565b602581527f61646472657373206d757374206265206973206c69676874206f7220636f6d6d60208201527f756e697479000000000000000000000000000000000000000000000000000000604082015260600190565b601181527f6164647265737320206973206c69676874000000000000000000000000000000602082015260400190565b805160009060c0840190614a8d858261413e565b506020830151614aa0602086018261413e565b506040830151614ab36040860182614ccd565b5060608301518482036060860152614acb828261437b565b9150506080830151614ae06080860182614ccd565b5060a0830151614af360a0860182614ccd565b509392505050565b8051600090610120840190614b10858261413e565b506020830151614b23602086018261413e565b506040830151614b366040860182614ccd565b5060608301518482036060860152614b4e828261437b565b9150506080830151614b636080860182614ccd565b5060a0830151614b7660a0860182614ccd565b5060c0830151614b8960c0860182614ccd565b5060e0830151614b9c60e0860182614cdf565b50610100830151614af3610100860182614ccd565b805160009060e0840190614bc5858261413e565b506020830151614bd8602086018261413e565b506040830151614beb6040860182614ccd565b506060830151614bfe6060860182614ccd565b5060808301518482036080860152614c16828261437b565b91505060a0830151614c2b60a0860182614ccd565b5060c083015184820360c0860152614c43828261437b565b95945050505050565b805160009060c0840190614c60858261413e565b506020830151614c73602086018261413e565b506040830151614c866040860182614cdf565b506060830151614c996060860182614ccd565b506080830151614cac6080860182614ccd565b5060a083015184820360a0860152614c43828261420f565b614147816150b1565b61414781610ad1565b614147816150b8565b614147816150c1565b60208101612e3b828461413e565b60a08101614d04828861413e565b614d11602083018761413e565b614d1e6040830186614ccd565b614d2b6060830185614ccd565b8181036080830152614d3d818461437b565b979650505050505050565b60208082528101610f48818461414d565b60208082528101610f4881846141b4565b60208082528101610f48818461426a565b60408082528101614d8c818561431c565b90508181036020830152613f6781846142c5565b60208101612e3b8284614369565b60208082528101612e3b8161442f565b60208082528101612e3b8161445f565b60208082528101612e3b816144b5565b60208082528101612e3b816144e5565b60208082528101612e3b81614515565b60208082528101612e3b8161456b565b60208082528101612e3b816145c1565b60208082528101612e3b816145f1565b60208082528101612e3b81614647565b60208082528101612e3b81614677565b60208082528101612e3b816146cd565b60208082528101612e3b816146fd565b60208082528101612e3b8161472d565b60208082528101612e3b8161475d565b60208082528101612e3b8161478d565b60208082528101612e3b816147bd565b60208082528101612e3b816147ed565b60208082528101612e3b8161481d565b60208082528101612e3b81614873565b60208082528101612e3b816148a3565b60208082528101612e3b816148d3565b60208082528101612e3b81614903565b60208082528101612e3b81614959565b60208082528101612e3b81614989565b60208082528101612e3b816149c3565b60208082528101612e3b816149f3565b60208082528101612e3b81614a49565b60208082528101610f488184614c4c565b60208101612e3b8284614cc4565b60208101612e3b8284614ccd565b60608101614f998286614ccd565b8181036020830152614fab81856143b0565b9050613f676040830184614372565b60608101614fc88285614ccd565b8181036020830152614fd9816149b9565b9050610f486040830184614372565b60408101614ff68285614ccd565b610f486020830184614ccd565b60208101612e3b8284614cd6565b60208101612e3b8284614cdf565b60405181810167ffffffffffffffff8111828210171561503e57600080fd5b604052919050565b600067ffffffffffffffff82111561505d57600080fd5b5060209081020190565b600067ffffffffffffffff82111561507e57600080fd5b506020601f91909101601f19160190565b60200190565b60009081526020902090565b5190565b600160a060020a031690565b61ffff1690565b63ffffffff1690565b60ff1690565b6000612e3b82610ad1565b6000612e3b826150c1565b82818337506000910152565b60005b838110156151045781810151838201526020016150ec565b838111156122fb5750506000910152565b601f01601f1916905600a265627a7a72305820c02e6b8bc57ba51ae64a6ec54db9ec73c2fed0e5b4109c28e86859ee6e5da69e6c6578706572696d656e74616cf50037`
	//新版本带事件10
	//REWARD_RATE_ABI = `[{"constant":true,"inputs":[{"name":"start","type":"uint256"},{"name":"end","type":"uint256"}],"name":"getAllLight","outputs":[{"components":[{"name":"addr","type":"address"},{"name":"c","type":"address"},{"name":"vote","type":"uint256"},{"name":"score","type":"uint256"},{"name":"cname","type":"string"},{"name":"blockHeight","type":"uint256"},{"name":"name","type":"string"}],"name":"","type":"tuple[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_value","type":"uint256"}],"name":"withDrawC","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getLightTotal","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"maxLightCount","outputs":[{"name":"","type":"uint16"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"addr","type":"address"}],"name":"queryAllReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getCommunityRewardList","outputs":[{"components":[{"name":"addr","type":"address"},{"name":"wit","type":"address"},{"name":"vote","type":"uint256"},{"name":"name","type":"string"},{"name":"score","type":"uint256"},{"name":"blockHeight","type":"uint256"},{"name":"reward","type":"uint256"},{"name":"rate","type":"uint8"},{"name":"lightCount","type":"uint256"}],"name":"","type":"tuple[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"addr","type":"address"}],"name":"getWiteVote","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"allReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"allCReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"w","type":"address"}],"name":"getCommunityListByWit","outputs":[{"components":[{"name":"addr","type":"address"},{"name":"wit","type":"address"},{"name":"vote","type":"uint256"},{"name":"name","type":"string"},{"name":"score","type":"uint256"},{"name":"blockHeight","type":"uint256"}],"name":"","type":"tuple[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"rate","type":"uint8"}],"name":"setRate","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"transferOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"c","type":"uint16"},{"name":"l","type":"uint16"}],"name":"setRoleLimit","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getAllCommunity","outputs":[{"components":[{"name":"addr","type":"address"},{"name":"wit","type":"address"},{"name":"vote","type":"uint256"},{"name":"name","type":"string"},{"name":"score","type":"uint256"},{"name":"blockHeight","type":"uint256"}],"name":"","type":"tuple[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"lastVoteOp","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"witnessRewardPool","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"communityRewardPool","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_value","type":"uint256"}],"name":"withDrawW","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"l","type":"address"}],"name":"getWitByL","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"w","type":"address"},{"name":"rate","type":"uint8"},{"name":"name","type":"string"}],"name":"addCommunity","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"remainCReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"w","type":"address"}],"name":"getWitnessInfo","outputs":[{"components":[{"name":"addr","type":"address"},{"name":"wit","type":"address"},{"name":"rate","type":"uint8"},{"name":"reward","type":"uint256"},{"name":"remainReward","type":"uint256"},{"components":[{"name":"addr","type":"address"},{"name":"wit","type":"address"},{"name":"vote","type":"uint256"},{"name":"name","type":"string"},{"name":"score","type":"uint256"},{"name":"blockHeight","type":"uint256"},{"name":"reward","type":"uint256"},{"name":"rate","type":"uint8"},{"name":"lightCount","type":"uint256"}],"name":"communitys","type":"tuple[]"}],"name":"","type":"tuple"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"list","type":"address[]"}],"name":"getCommunityList","outputs":[{"components":[{"name":"addr","type":"address"},{"name":"wit","type":"address"},{"name":"vote","type":"uint256"},{"name":"name","type":"string"},{"name":"score","type":"uint256"},{"name":"blockHeight","type":"uint256"}],"name":"","type":"tuple[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_value","type":"uint256"}],"name":"withDrawL","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getRate","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"addr","type":"address"}],"name":"getAddrState","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"c","type":"address"}],"name":"addVote","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"addrRate","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"addr","type":"address"}],"name":"getRatio","outputs":[{"name":"","type":"uint32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getOwner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"lightMap","outputs":[{"name":"addr","type":"address"},{"name":"c","type":"address"},{"name":"vote","type":"uint256"},{"name":"blockHeight","type":"uint256"},{"name":"name","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"vote","type":"uint256"}],"name":"delVote","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"communityDistribute","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"delLight","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"maxCommunityCount","outputs":[{"name":"","type":"uint16"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"remainReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"lastRewardBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"c","type":"address"}],"name":"getWitByC","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"remainLReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"name","type":"string"}],"name":"addLight","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"allLReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"list","type":"address[]"},{"name":"index","type":"uint256"},{"name":"totalReward","type":"uint256"}],"name":"distribute","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"delCommunity","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"addr","type":"address"}],"name":"getCommVote","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"deposit","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"list","type":"address[]"}],"name":"getLightList","outputs":[{"components":[{"name":"addr","type":"address"},{"name":"c","type":"address"},{"name":"vote","type":"uint256"},{"name":"score","type":"uint256"},{"name":"cname","type":"string"},{"name":"blockHeight","type":"uint256"},{"name":"name","type":"string"}],"name":"","type":"tuple[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"remainWReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"c","type":"address"}],"name":"getLightListByC","outputs":[{"components":[{"name":"addr","type":"address"},{"name":"c","type":"address"},{"name":"vote","type":"uint256"},{"name":"score","type":"uint256"},{"name":"cname","type":"string"},{"name":"blockHeight","type":"uint256"},{"name":"name","type":"string"}],"name":"","type":"tuple[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"addrs","type":"address[]"}],"name":"getRateAndVoteByAddrs","outputs":[{"name":"","type":"uint8[]"},{"name":"","type":"uint256[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"allWReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getRoleTotal","outputs":[{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"into","type":"address"},{"indexed":true,"name":"from","type":"address"},{"indexed":false,"name":"reward","type":"uint256"},{"indexed":false,"name":"name","type":"string"},{"indexed":false,"name":"utype","type":"uint8"}],"name":"LogRewardHistory","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"addr","type":"address"},{"indexed":false,"name":"reward","type":"uint256"}],"name":"WithDrawReward","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"community","type":"address"},{"indexed":false,"name":"reward","type":"uint256"}],"name":"LogCommunityRewardPool","type":"event"}]`
	//REWARD_RATE_BIN = `608060405260148054606461ffff199091161763ffff0000191662c800001790556000601555610258601655600a601a5534801561003c57600080fd5b50601c8054600160a060020a031916331790556151598061005e6000396000f3006080604052600436106102665763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663021f67db811461026b5780630c0d831d146102a15780630fbcbeb3146102c35780630fc964e6146102e55780631000f62d1461030757806321a09b46146103275780632ceb9e7b1461034957806341eac22414610369578063447db0c314610389578063473f781f146103a95780634afe2f80146103d65780634fb2e45d146103f657806353a4f0c31461041657806356d2e56314610436578063582b1e231461044b57806359bdc1351461046b57806359fd379d1461048b5780635a9499e0146104ab5780635c99bc5b146104cb5780635d7871ba146104f857806360db14a71461050b57806361adc1021461052b578063636ed4c31461055857806364ab6c6914610578578063679aefce146105985780636a37e368146105ba5780636cea0e46146105da5780637486f6cd146105ed578063754b27071461060d578063893d20e81461063a5780638fbe78bb1461064f5780639351f4f21461068057806396a9fd72146106a05780639fe8326a146106b5578063a21814fd146106ca578063a498a0c4146106df578063a9f8d181146106ff578063af43bb0114610714578063bbff252e14610734578063c9fd650d14610754578063caf82b3f14610767578063d0558c3414610787578063d8593433146107a7578063dd7ae3b7146107bc578063f340fa01146107dc578063f817f07c146107fc578063f855477a1461081c578063f92443831461083c578063fa969dd11461085c578063fb7d87701461088a578063fe22ca14146108aa575b600080fd5b34801561027757600080fd5b5061028b6102863660046140f0565b6108cd565b6040516102989190614d6a565b60405180910390f35b3480156102ad57600080fd5b506102c16102bc3660046140d2565b6109e8565b005b3480156102cf57600080fd5b506102d8610ac2565b6040516102989190614f7d565b3480156102f157600080fd5b506102fa610ad4565b6040516102989190614f6f565b34801561031357600080fd5b506102d8610322366004613f49565b610ae4565b34801561033357600080fd5b5061033c610b03565b6040516102989190614d59565b34801561035557600080fd5b506102d8610364366004613f49565b610eb8565b34801561037557600080fd5b506102d8610384366004613f49565b610ed6565b34801561039557600080fd5b506102d86103a4366004613f49565b610ee8565b3480156103b557600080fd5b506103c96103c4366004613f49565b610efa565b6040516102989190614d48565b3480156103e257600080fd5b506102c16103f1366004614120565b610f4f565b34801561040257600080fd5b506102c1610411366004613f49565b610f99565b34801561042257600080fd5b506102c1610431366004614098565b610ffb565b34801561044257600080fd5b506103c9611052565b34801561045757600080fd5b506102d8610466366004613f49565b611071565b34801561047757600080fd5b506102d8610486366004613f49565b611083565b34801561049757600080fd5b506102d86104a6366004613f49565b611095565b3480156104b757600080fd5b506102c16104c63660046140d2565b6110a7565b3480156104d757600080fd5b506104eb6104e6366004613f49565b61113c565b6040516102989190614ce8565b6102c1610506366004613f6f565b611170565b34801561051757600080fd5b506102d8610526366004613f49565b61135e565b34801561053757600080fd5b5061054b610546366004613f49565b611370565b6040516102989190614f5e565b34801561056457600080fd5b506103c9610573366004613fd4565b611790565b34801561058457600080fd5b506102c16105933660046140d2565b611a60565b3480156105a457600080fd5b506105ad611af5565b6040516102989190615011565b3480156105c657600080fd5b506102d86105d5366004613f49565b611b0b565b6102c16105e8366004613f49565b611b68565b3480156105f957600080fd5b506105ad610608366004613f49565b611e46565b34801561061957600080fd5b5061062d610628366004613f49565b611e5b565b6040516102989190615003565b34801561064657600080fd5b506104eb612004565b34801561065b57600080fd5b5061066f61066a366004613f49565b612013565b604051610298959493929190614cf6565b34801561068c57600080fd5b506102c161069b3660046140d2565b6120db565b3480156106ac57600080fd5b506102c1612301565b3480156106c157600080fd5b506102c161238a565b3480156106d657600080fd5b506102fa612488565b3480156106eb57600080fd5b506102d86106fa366004613f49565b612492565b34801561070b57600080fd5b506102d86124a4565b34801561072057600080fd5b506104eb61072f366004613f49565b6124aa565b34801561074057600080fd5b506102d861074f366004613f49565b6124cb565b6102c1610762366004614063565b6124dd565b34801561077357600080fd5b506102d8610782366004613f49565b6125b5565b34801561079357600080fd5b506102c16107a2366004614009565b6125c7565b3480156107b357600080fd5b506102c1612642565b3480156107c857600080fd5b506102d86107d7366004613f49565b6127ca565b3480156107e857600080fd5b506102d86107f7366004613f49565b6127e8565b34801561080857600080fd5b5061028b610817366004613fd4565b6127fa565b34801561082857600080fd5b506102d8610837366004613f49565b612bb3565b34801561084857600080fd5b5061028b610857366004613f49565b612bc5565b34801561086857600080fd5b5061087c610877366004613fd4565b612c13565b604051610298929190614d7b565b34801561089657600080fd5b506102d86108a5366004613f49565b612d4c565b3480156108b657600080fd5b506108bf612d5e565b604051610298929190614fe8565b6060806000806108dd6004612d7d565b805190935086111561090d5760405160e560020a62461bcd02815260040161090490614e7e565b60405180910390fd5b825185111561091b57825194505b50845b8481101561097a5781838281518110151561093557fe5b6020908102919091018101518254600180820185556000948552929093209092018054600160a060020a031916600160a060020a03909316929092179091550161091e565b6109dc828054806020026020016040519081016040528092919081815260200182805480156109d257602002820191906000526020600020905b8154600160a060020a031681526001909101906020018083116109b4575b50505050506127fa565b93505b50505092915050565b336000908152600e6020526040902054811115610a1a5760405160e560020a62461bcd02815260040161090490614dfe565b3031811115610a3e5760405160e560020a62461bcd02815260040161090490614e8e565b336000818152600e6020526040808220805485900390555183156108fc0291849190818181858888f19350505050158015610a7d573d6000803e3d6000fd5b5033600160a060020a03167fc022fd2810d6ccb154ceb0f84df7a7627dac40716b0f9bb82c87d8598e696b3682604051610ab79190614f7d565b60405180910390a250565b6000610ace6004612e18565b90505b90565b60145462010000900461ffff1681565b600160a060020a0381166000908152600960205260409020545b919050565b60608060606000610b146002612d7d565b92508251604051908082528060200260200182016040528015610b5157816020015b610b3e613be5565b815260200190600190039081610b365790505b509150600090505b8251811015610eb15761012060405190810160405280600760008685815181101515610b8157fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060000160009054906101000a9004600160a060020a0316600160a060020a03168152602001600760008685815181101515610be257fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060010160009054906101000a9004600160a060020a0316600160a060020a03168152602001600760008685815181101515610c4357fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020600201548152602001600760008685815181101515610c8857fe5b602090810291909101810151600160a060020a031682528181019290925260409081016000206003018054825160026001831615610100026000190190921691909104601f810185900485028201850190935282815292909190830182828015610d335780601f10610d0857610100808354040283529160200191610d33565b820191906000526020600020905b815481529060010190602001808311610d1657829003601f168201915b50505050508152602001601260008685815181101515610d4f57fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020548152602001600760008685815181101515610d9157fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020600401548152602001600d60008685815181101515610dd657fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020548152602001601160008685815181101515610e1857fe5b6020908102909101810151600160a060020a031682528181019290925260400160009081205460ff16835286519290910191610e8f91600791889087908110610e5d57fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020600501612e18565b90528251839083908110610e9f57fe5b60209081029091010152600101610b59565b5092915050565b600160a060020a031660009081526008602052604090206001015490565b60096020526000908152604090205481565b600d6020526000908152604090205481565b600160a060020a03811660009081526008602052604081206003810180546060938493600201929091610f2f91600191613c47565b50905050610f3d6000612d7d565b9050610f4881611790565b9392505050565b606460ff82161115610f765760405160e560020a62461bcd02815260040161090490614f1e565b336000908152601160205260409020805460ff191660ff92909216919091179055565b601c54600160a060020a03163314610fc65760405160e560020a62461bcd02815260040161090490614f2e565b33600160a060020a0382161415610fdc57610ff8565b601c8054600160a060020a031916600160a060020a0383161790555b50565b601c54600160a060020a031633146110285760405160e560020a62461bcd02815260040161090490614f2e565b6014805461ffff928316620100000263ffff0000199490931661ffff199091161792909216179055565b60608061105f6002612d7d565b905061106a81611790565b91505b5090565b601b6020526000908152604090205481565b60176020526000908152604090205481565b60136020526000908152604090205481565b336000908152600c60205260409020548111156110d95760405160e560020a62461bcd02815260040161090490614dfe565b30318111156110fd5760405160e560020a62461bcd02815260040161090490614e8e565b336000818152600c6020526040808220805485900390555183156108fc0291849190818181858888f19350505050158015610a7d573d6000803e3d6000fd5b600160a060020a03908116600090815260066020908152604080832060019081015485168452600790925290912001541690565b606460ff831611156111975760405160e560020a62461bcd02815260040161090490614f1e565b33600090815260066020526040902054600160a060020a0316156111d05760405160e560020a62461bcd02815260040161090490614f4e565b33600090815260076020526040902060010154600160a060020a03161561120c5760405160e560020a62461bcd02815260040161090490614e4e565b60145461ffff1661121d6002612e18565b1061123d5760405160e560020a62461bcd02815260040161090490614dce565b336000818152600760209081526040808320600290810154600160a060020a0389168552600890935292206001810180549092019091556112869291019063ffffffff612e1f16565b15156112b757600160a060020a03831660009081526008602052604090206112b7906002013363ffffffff612e4116565b336000818152600760209081526040909120600181018054600160a060020a038816600160a060020a031991821617909155815416909217825582516113039260030191840190613c93565b503360008181526007602090815260408083204360049091015560118252808320805460ff191660ff88161790556012909152902034905561134790600290612e41565b5050336000908152601b6020526040902043905550565b600e6020526000908152604090205481565b611378613d0d565b600160a060020a038216600090815260116020908152604080832054600b835281842054600c845282852054600890945291842060038101805460ff909316959394936060938493919260029092019183916113d691600191613c47565b509050506113e46000612d7d565b9250825160405190808252806020026020018201604052801561142157816020015b61140e613be5565b8152602001906001900390816114065790505b509150600090505b825181101561174f576101206040519081016040528060076000868581518110151561145157fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060000160009054906101000a9004600160a060020a0316600160a060020a031681526020016007600086858151811015156114b257fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060010160009054906101000a9004600160a060020a0316600160a060020a0316815260200160076000868581518110151561151357fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060020154815260200160076000868581518110151561155857fe5b602090810291909101810151600160a060020a031682528181019290925260409081016000206003018054825160026001831615610100026000190190921691909104601f8101859004850282018501909352828152929091908301828280156116035780601f106115d857610100808354040283529160200191611603565b820191906000526020600020905b8154815290600101906020018083116115e657829003601f168201915b5050505050815260200160126000868581518110151561161f57fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002054815260200160076000868581518110151561166157fe5b90602001906020020151600160a060020a0316600160a060020a031681526020019081526020016000206004015481526020016009600086858151811015156116a657fe5b90602001906020020151600160a060020a0316600160a060020a031681526020019081526020016000205481526020016011600086858151811015156116e857fe5b6020908102909101810151600160a060020a031682528181019290925260400160009081205460ff1683528651929091019161172d91600791889087908110610e5d57fe5b9052825183908390811061173d57fe5b60209081029091010152600101611429565b506040805160c081018252600160a060020a03909816808952602089015260ff90951694870194909452506060850191909152608084015260a08301525090565b606080600083516040519080825280602002602001820160405280156117d057816020015b6117bd613d59565b8152602001906001900390816117b55790505b509150600090505b8351811015610eb15760c0604051908101604052806007600087858151811015156117ff57fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060000160009054906101000a9004600160a060020a0316600160a060020a0316815260200160076000878581518110151561186057fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060010160009054906101000a9004600160a060020a0316600160a060020a031681526020016007600087858151811015156118c157fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060020154815260200160076000878581518110151561190657fe5b602090810291909101810151600160a060020a031682528181019290925260409081016000206003018054825160026001831615610100026000190190921691909104601f8101859004850282018501909352828152929091908301828280156119b15780601f10611986576101008083540402835291602001916119b1565b820191906000526020600020905b81548152906001019060200180831161199457829003601f168201915b505050505081526020016012600087858151811015156119cd57fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020548152602001600760008785815181101515611a0f57fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020600401548152508282815181101515611a4e57fe5b602090810290910101526001016117d8565b33600090815260106020526040902054811115611a925760405160e560020a62461bcd02815260040161090490614dfe565b3031811115611ab65760405160e560020a62461bcd02815260040161090490614e8e565b33600081815260106020526040808220805485900390555183156108fc0291849190818181858888f19350505050158015610a7d573d6000803e3d6000fd5b3360009081526011602052604090205460ff1690565b600160a060020a0381811660009081526006602052604081205490911615611b3557506003610afe565b600160a060020a038281166000908152600760205260409020600101541615611b6057506002610afe565b506004919050565b33600090815260066020526040812054600160a060020a03161515611ba25760405160e560020a62461bcd02815260040161090490614eee565b33600090815260076020526040902060010154600160a060020a031615611bde5760405160e560020a62461bcd02815260040161090490614e0e565b600160a060020a03828116600090815260076020526040902060010154161515611c1d5760405160e560020a62461bcd02815260040161090490614ede565b33600090815260066020526040902060010154600160a060020a03161580611c62575033600090815260066020526040902060010154600160a060020a038381169116145b1515611c835760405160e560020a62461bcd02815260040161090490614e1e565b600160a060020a0382166000908152600760205260409020611cae906005013363ffffffff612e1f16565b158015611cec5750601454600160a060020a03831660009081526007602052604090206201000090910461ffff1690611ce990600501612e18565b10155b15611d0c5760405160e560020a62461bcd02815260040161090490614dae565b611d1582612edc565b600160a060020a038216600090815260076020526040902060028101805434019055611d4a906005013363ffffffff612e1f16565b1515611d7b57600160a060020a0382166000908152600760205260409020611d7b906005013363ffffffff612e4116565b5033600090815260066020908152604080832060018082018054600160a060020a031916600160a060020a038881169182179092556002909301805434019055918552600790935292200154168015611e2057600160a060020a0381166000908152600860205260409020611df9906002018363ffffffff612e1f16565b15611e2057600160a060020a03811660009081526008602052604090206001018054340190555b5050336000908152601260209081526040808320805434019055601b9091529020439055565b60116020526000908152604090205460ff1681565b600160a060020a038181166000908152600660205260408120600101549091161580611ea25750600160a060020a0382811660009081526007602052604090206001015416155b1515611ec35760405160e560020a62461bcd02815260040161090490614f3e565b600160a060020a038281166000908152600660205260409020600101541615611f6257600160a060020a0382166000908152600660205260409020600201541515611f1057506000610afe565b600160a060020a038083166000818152600660208181526040808420600181015490961684526007825283206002908101549490935252909101546305f5e10002811515611f5a57fe5b049050610afe565b600160a060020a038281166000908152600760205260409020600101541615611ffc57600160a060020a0382166000908152600760205260409020600201541515611faf57506000610afe565b600160a060020a038083166000818152600760208181526040808420600180820154909716855260088352908420909501549390925290526002909101546305f5e10002811515611f5a57fe5b506000919050565b601c54600160a060020a031690565b600660209081526000918252604091829020805460018083015460028085015460038601546004870180548a516101009782161597909702600019011693909304601f8101899004890286018901909952888552600160a060020a0395861698959093169690959294929392908301828280156120d15780601f106120a6576101008083540402835291602001916120d1565b820191906000526020600020905b8154815290600101906020018083116120b457829003601f168201915b5050505050905085565b33600090815260066020526040812060020154819081908411156121145760405160e560020a62461bcd02815260040161090490614efe565b33600090815260066020526040902060010154600160a060020a031692508215156121545760405160e560020a62461bcd02815260040161090490614e9e565b431561219657336000908152601b6020526040902054601a54439190910392508210156121965760405160e560020a62461bcd02815260040161090490614e5e565b600160a060020a038316156122fb576121ae83612edc565b600160a060020a03831660009081526007602090815260408083206002908101805489900390553384526006909252909120015484141561223557600160a060020a0383166000908152600760205260409020612214906005013363ffffffff6132f616565b3360009081526006602052604090206001018054600160a060020a03191690555b600160a060020a0383811660009081526007602052604090206001015416156122945750600160a060020a0380831660009081526007602090815260408083206001908101549094168084526008909252909120909101805485900390555b336000818152601260209081526040808320805489900390556006909152808220600201805488900390555186156108fc0291879190818181858888f193505050501580156122e7573d6000803e3d6000fd5b50336000908152601b602052604090204390555b50505050565b33600081815260076020526040902060010154600160a060020a031615156123815733600090815260066020526040902060010154600160a060020a031615612366575033600090815260066020526040902060010154600160a060020a0316612381565b60405160e560020a62461bcd02815260040161090490614e3e565b610ff881612edc565b33600090815260066020526040812060020154156123bd5760405160e560020a62461bcd02815260040161090490614e2e565b33600090815260066020526040902054600160a060020a031615156123f75760405160e560020a62461bcd02815260040161090490614eae565b33600090815260066020526040902054600160a060020a031615610ff8575033600081815260126020908152604080832080549084905560069092529091208054600160a060020a0319169055906124579060049063ffffffff6132f616565b604051339082156108fc029083906000818181858888f19350505050158015612484573d6000803e3d6000fd5b5050565b60145461ffff1681565b600a6020526000908152604090205481565b60155481565b600160a060020a039081166000908152600760205260409020600101541690565b60106020526000908152604090205481565b33600090815260076020526040902060010154600160a060020a0316156125195760405160e560020a62461bcd02815260040161090490614e0e565b33600090815260066020526040902054600160a060020a0316156125525760405160e560020a62461bcd02815260040161090490614e6e565b3360008181526006602090815260409091208054600160a060020a0319169092178255436003830155825161258d9260040191840190613c93565b50336000818152601260205260409020805434019055610ff89060049063ffffffff612e4116565b600f6020526000908152604090205481565b6000821180156125d8575060008351115b80156125e45750600081115b15156126055760405160e560020a62461bcd02815260040161090490614f0e565b6126108383836133e8565b6015544311158061262657506016546015544303105b156126305761263d565b61263861366f565b436015555b505050565b3360009081526007602052604081206001015481908190600160a060020a031615156126835760405160e560020a62461bcd02815260040161090490614dde565b43156126c557336000908152601b6020526040902054601a54439190910393508310156126c55760405160e560020a62461bcd02815260040161090490614ece565b33600090815260076020526040902060010154600160a060020a03161561263d57336000818152600760209081526040808320600180820154600292830154600160a060020a03909116808752600890955292909420938401805492909203909155909450612736929101906132f6565b503360008181526007602090815260408083206001018054600160a060020a0319169055601290915281208054919055906127799060029063ffffffff6132f616565b604051339082156108fc029083906000818181858888f193505050501580156127a6573d6000803e3d6000fd5b506127b033612edc565b336000908152601260205260409020805434019055505050565b600160a060020a031660009081526007602052604090206002015490565b60126020526000908152604090205481565b6060806000835160405190808252806020026020018201604052801561283a57816020015b612827613da2565b81526020019060019003908161281f5790505b509150600090505b8351811015610eb15760e06040519081016040528060066000878581518110151561286957fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060000160009054906101000a9004600160a060020a0316600160a060020a031681526020016006600087858151811015156128ca57fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060010160009054906101000a9004600160a060020a0316600160a060020a0316815260200160066000878581518110151561292b57fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060020154815260200160126000878581518110151561297057fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020548152602001600760006006600089878151811015156129b657fe5b6020908102909101810151600160a060020a039081168352828201939093526040918201600090812060019081015490941685528482019590955292810190932060030180548451601f60026000199584161561010002959095019092169390930490810184900484028301840190945283825290929091830182828015612a7f5780601f10612a5457610100808354040283529160200191612a7f565b820191906000526020600020905b815481529060010190602001808311612a6257829003601f168201915b50505050508152602001600660008785815181101515612a9b57fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020600301548152602001600660008785815181101515612ae057fe5b602090810291909101810151600160a060020a031682528181019290925260409081016000206004018054825160026001831615610100026000190190921691909104601f810185900485028201850190935282815292909190830182828015612b8b5780601f10612b6057610100808354040283529160200191612b8b565b820191906000526020600020905b815481529060010190602001808311612b6e57829003601f168201915b50505050508152508282815181101515612ba157fe5b60209081029091010152600101612842565b600c6020526000908152604090205481565b600160a060020a03811660009081526007602052604081206006810180546060938493600501929091612bfa91600191613c47565b50905050612c086000612d7d565b9050610f48816127fa565b60608060608060008551604051908082528060200260200182016040528015612c46578160200160208202803883390190505b5092508551604051908082528060200260200182016040528015612c74578160200160208202803883390190505b509150600090505b8551811015612d4157601160008783815181101515612c9757fe5b6020908102909101810151600160a060020a0316825281019190915260400160002054835160ff90911690849083908110612cce57fe5b60ff9092166020928302909101909101528551600890600090889084908110612cf357fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020600101548282815181101515612d2f57fe5b60209081029091010152600101612c7c565b509094909350915050565b600b6020526000908152604090205481565b600080612d6b6002612e18565b612d756004612e18565b915091509091565b60608060008360010180549050604051908082528060200260200182016040528015612db3578160200160208202803883390190505b5091505b6001840154811015610eb15760018401805482908110612dd357fe5b6000918252602090912001548251600160a060020a0390911690839083908110612df957fe5b600160a060020a03909216602092830290910190910152600101612db7565b6001015490565b600160a060020a03811660009081526020839052604090205415155b92915050565b600160a060020a0381161515612e6c5760405160e560020a62461bcd02815260040161090490614ebe565b612e768282612e1f565b15612e965760405160e560020a62461bcd02815260040161090490614dbe565b600180830180549182018155600081815260208082209093018054600160a060020a03909516600160a060020a0319909516851790559054928152929052604090912055565b600160a060020a038116600090815260136020526040812054819081906060908290819081901515612f0d576132ec565b600160a060020a03881660008181526013602052604080822080549083905590519099507f02cba861472fe08dca0820f37bb0d7194b85309abefa8ac3f04733b987ce8afc91612f5c91614da0565b60405180910390a2600160a060020a03881660009081526011602052604090205460649060ff168802049550600086111561323857600160a060020a038816600090815260076020526040812060068101805489985060059092019291612fc591600191613c47565b50905050612fd36000612d7d565b9350600092505b83518310156132385760006130058585815181101515612ff657fe5b90602001906020020151611e5b565b63ffffffff16111561322d576305f5e1006130278585815181101515612ff657fe5b63ffffffff16870281151561303857fe5b04915081850394508160096000868681518110151561305357fe5b90602001906020020151600160a060020a0316600160a060020a031681526020019081526020016000206000828254019250508190555081600a6000868681518110151561309d57fe5b90602001906020020151600160a060020a0316600160a060020a031681526020019081526020016000206000828254019250508190555081600f600086868151811015156130e757fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020600082825401925050819055508160106000868681518110151561313157fe5b90602001906020020151600160a060020a0316600160a060020a031681526020019081526020016000206000828254019250508190555087600160a060020a0316848481518110151561318057fe5b90602001906020020151600160a060020a03167f900928d4a48773c713a00e26efa83f1f9fe5a1e65bb937e6d8773daf54112983846006600089898151811015156131c757fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020600401600360405161320593929190614f8b565b60405180910390a361322d848481518110151561321e57fe5b90602001906020020151613994565b600190920191612fda565b50848603840160008111156132ec57600160a060020a038089166000818152600960209081526040808320805487019055600a8252808320805487019055600d8252808320805487019055600e82528083208054870190556007909152908190206001810154915191909316927f900928d4a48773c713a00e26efa83f1f9fe5a1e65bb937e6d8773daf54112983916132db918691600390910190600290614f8b565b60405180910390a36132ec88613a6a565b5050505050505050565b60008060006133058585612e1f565b15156133265760405160e560020a62461bcd02815260040161090490614dee565b600160a060020a03841660009081526020869052604090205460018601805460001992830195509182019350908390811061335d57fe5b600091825260209091200154600186018054600160a060020a03909216925082918590811061338857fe5b60009182526020808320919091018054600160a060020a031916600160a060020a03948516179055838316825287905260408082206001878101909155928716825281205585018054906133e0906000198301613df2565b505050505050565b60008080808080808080806064601e8c02049950898b0398508c518a81151561340d57fe5b04975060009650600095505b8c5186101561347f578b861061342e5761347f565b600860008e8881518110151561344057fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060010154870196508580600101965050613419565b60009450861515613499578b8981151561349557fe5b0494505b60009350600192505b8c518310156135c0578791508b83101561352057600087111561351b57613509600860008f868151811015156134d457fe5b90602001906020020151600160a060020a0316600160a060020a0316815260200190815260200160002060010154888e613afa565b90506305f5e100898202049450928401925b908401905b6135498d8481518110151561353157fe5b6020908102909101015160189063ffffffff612e1f16565b1515613578576135788d8481518110151561356057fe5b6020908102909101015160189063ffffffff612e4116565b81601760008f8681518110151561358b57fe5b6020908102909101810151600160a060020a0316825281019190915260400160002080549091019055600192909201916134a2565b8c518a8115156135cc57fe5b068801915060008711156135e657838903820191506135f9565b8b898115156135f157fe5b068501820191505b61360b8d600081518110151561353157fe5b1515613623576136238d600081518110151561356057fe5b81601760008f600081518110151561363757fe5b6020908102909101810151600160a060020a031682528101919091526040016000208054909101905550505050505050505050505050565b6000806000806000606060008060006136886018612e18565b151561369357613989565b600061369f6018612e18565b1115613989576136c460016136b46018612e18565b601891900363ffffffff613b2616565b98506136d760188a63ffffffff6132f616565b600160a060020a03891660009081526017602052604090205415156136fb57613693565b600160a060020a0389166000908152601760209081526040808320805490849055601190925282205490995090975060ff16871080156137545750600160a060020a038916600090815260086020526040812060010154115b1561377e57600160a060020a03891660009081526011602052604090205460649060ff1689020496505b6000955060008711156138e757600160a060020a038916600090815260086020526040902087965060020194506137b485612d7d565b9350600092505b83518310156138e7578515156137d0576138e7565b6305f5e1006137e68585815181101515612ff657fe5b63ffffffff1688028115156137f757fe5b049150811515613806576138dc565b81860395508160136000868681518110151561381e57fe5b6020908102909101810151600160a060020a0316825281019190915260400160002080549091019055835184908490811061385557fe5b90602001906020020151600160a060020a03167f02cba861472fe08dca0820f37bb0d7194b85309abefa8ac3f04733b987ce8afc60136000878781518110151561389b57fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020546040516138d39190614f7d565b60405180910390a25b6001909201916137bb565b508587038501600081111561398457600160a060020a0389166000818152600960209081526040808320805486019055600a8252808320805486019055600b8252808320805486019055600c909152808220805485019055519091907f900928d4a48773c713a00e26efa83f1f9fe5a1e65bb937e6d8773daf5411298390613973908590600190614fba565b60405180910390a361398489613b55565b613693565b505050505050505050565b600160a060020a038116600090815260106020526040812054811080156139d45750600160a060020a038216600090815260106020526040902054303110155b156124845750600160a060020a038116600081815260106020526040808220805490839055905190929183156108fc02918491818181858888f19350505050158015613a24573d6000803e3d6000fd5b5081600160a060020a03167fc022fd2810d6ccb154ceb0f84df7a7627dac40716b0f9bb82c87d8598e696b3682604051613a5e9190614f7d565b60405180910390a25050565b600160a060020a0381166000908152600e602052604081205481108015613aaa5750600160a060020a0382166000908152600e6020526040902054303110155b156124845750600160a060020a0381166000818152600e6020526040808220805490839055905190929183156108fc02918491818181858888f19350505050158015613a24573d6000803e3d6000fd5b60006305f5e1006509184e72a00083810285018682018302811515613b1b57fe5b049695505050505050565b60008260010182815481101515613b3957fe5b600091825260209091200154600160a060020a03169392505050565b600160a060020a0381166000908152600c602052604081205481108015613b955750600160a060020a0382166000908152600c6020526040902054303110155b156124845750600160a060020a0381166000818152600c6020526040808220805490839055905190929183156108fc02918491818181858888f19350505050158015613a24573d6000803e3d6000fd5b610120604051908101604052806000600160a060020a031681526020016000600160a060020a031681526020016000815260200160608152602001600081526020016000815260200160008152602001600060ff168152602001600081525090565b828054828255906000526020600020908101928215613c875760005260206000209182015b82811115613c87578254825591600101919060010190613c6c565b5061106d929150613e16565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10613cd457805160ff1916838001178555613d01565b82800160010185558215613d01579182015b82811115613d01578251825591602001919060010190613ce6565b5061106d929150613e3a565b60c0604051908101604052806000600160a060020a031681526020016000600160a060020a03168152602001600060ff1681526020016000815260200160008152602001606081525090565b60c0604051908101604052806000600160a060020a031681526020016000600160a060020a03168152602001600081526020016060815260200160008152602001600081525090565b60e0604051908101604052806000600160a060020a031681526020016000600160a060020a0316815260200160008152602001600081526020016060815260200160008152602001606081525090565b81548183558181111561263d5760008381526020902061263d918101908301613e3a565b610ad191905b8082111561106d578054600160a060020a0319168155600101613e1c565b610ad191905b8082111561106d5760008155600101613e40565b6000610f4882356150a5565b6000601f82018313613e7157600080fd5b8135613e84613e7f82615046565b61501f565b91508181835260208401935060208101905083856020840282011115613ea957600080fd5b60005b83811015613ed55781613ebf8882613e54565b8452506020928301929190910190600101613eac565b5050505092915050565b6000601f82018313613ef057600080fd5b8135613efe613e7f82615067565b91508082526020830160208301858383011115613f1a57600080fd5b6109df8382846150dd565b6000610f4882356150b1565b6000610f488235610ad1565b6000610f4882356150c1565b600060208284031215613f5b57600080fd5b6000613f678484613e54565b949350505050565b600080600060608486031215613f8457600080fd5b6000613f908686613e54565b9350506020613fa186828701613f3d565b925050604084013567ffffffffffffffff811115613fbe57600080fd5b613fca86828701613edf565b9150509250925092565b600060208284031215613fe657600080fd5b813567ffffffffffffffff811115613ffd57600080fd5b613f6784828501613e60565b60008060006060848603121561401e57600080fd5b833567ffffffffffffffff81111561403557600080fd5b61404186828701613e60565b935050602061405286828701613f31565b9250506040613fca86828701613f31565b60006020828403121561407557600080fd5b813567ffffffffffffffff81111561408c57600080fd5b613f6784828501613edf565b600080604083850312156140ab57600080fd5b60006140b78585613f25565b92505060206140c885828601613f25565b9150509250929050565b6000602082840312156140e457600080fd5b6000613f678484613f31565b6000806040838503121561410357600080fd5b600061410f8585613f31565b92505060206140c885828601613f31565b60006020828403121561413257600080fd5b6000613f678484613f3d565b614147816150a5565b82525050565b6000614158826150a1565b808452602084019350836020820285016141718561508f565b60005b848110156141a857838303885261418c838351614a79565b92506141978261508f565b602098909801979150600101614174565b50909695505050505050565b60006141bf826150a1565b808452602084019350836020820285016141d88561508f565b60005b848110156141a85783830388526141f3838351614afb565b92506141fe8261508f565b6020989098019791506001016141db565b600061421a826150a1565b808452602084019350836020820285016142338561508f565b60005b848110156141a857838303885261424e838351614afb565b92506142598261508f565b602098909801979150600101614236565b6000614275826150a1565b8084526020840193508360208202850161428e8561508f565b60005b848110156141a85783830388526142a9838351614bb1565b92506142b48261508f565b602098909801979150600101614291565b60006142d0826150a1565b8084526020840193506142e28361508f565b60005b82811015614312576142f8868351614ccd565b6143018261508f565b6020969096019591506001016142e5565b5093949350505050565b6000614327826150a1565b8084526020840193506143398361508f565b60005b828110156143125761434f868351614cdf565b6143588261508f565b60209690960195915060010161433c565b614147816150c7565b614147816150d2565b6000614386826150a1565b80845261439a8160208601602086016150e9565b6143a381615115565b9093016020019392505050565b6000815460018116600081146143cd57600181146143eb57614427565b60028204607f16855260ff1982166020860152604085019250614427565b6002820480865260208601955061440185615095565b60005b8281101561442057815488820152600190910190602001614404565b8701945050505b505092915050565b601481527f6c69676874206c696d6974206f766572666c6f77000000000000000000000000602082015260400190565b602f81527f4c6962416464726573735365743a2076616c756520616c72656164792065786960208201527f73747320696e20746865207365742e0000000000000000000000000000000000604082015260600190565b601881527f636f6d6d756e697479206c696d6974206f766572666c6f770000000000000000602082015260400190565b601981527f61646472657373206d75737420626520636f6d6d756e69747900000000000000602082015260400190565b602381527f4c6962416464726573735365743a2076616c756520646f65736e27742065786960208201527f73742e0000000000000000000000000000000000000000000000000000000000604082015260600190565b602f81527f616d6f756e74206d757374206265206c657373206f7220657175616c20796f7560208201527f722072656d61696e207265776172640000000000000000000000000000000000604082015260600190565b601481527f6164647265737320697320636f6d6d756e697479000000000000000000000000602082015260400190565b602981527f63616e6e6f7420766f746520666f7220206d756c7469706c6520636f6d6d756e60208201527f697479206e6f6465730000000000000000000000000000000000000000000000604082015260600190565b601781527f61646472657373206d757374206265206e6f20766f7465000000000000000000602082015260400190565b602d81527f646973747269627574652061646472657373206d75737420626520636f6d6d7560208201527f6e697479206f72206c6967687400000000000000000000000000000000000000604082015260600190565b601581527f61646472657373206861732061207769746e6573730000000000000000000000602082015260400190565b601581527f63616e63656c20766f746520746f6f206f6674656e0000000000000000000000602082015260400190565b601781527f6164647265737320616c72656164792061206c69676874000000000000000000602082015260400190565b601081527f737461727420697320746f6f2062696700000000000000000000000000000000602082015260400190565b601181527f616d6f756e7420697320696c6c6567616c000000000000000000000000000000602082015260400190565b601f81527f61646472657373206d7573742068617320766f746520636f6d6d756e69747900602082015260400190565b601581527f61646472657373206d757374206265206c696768740000000000000000000000602082015260400190565b602181527f4c6962416464726573735365743a2076616c75652063616e277420626520307860208201527f3000000000000000000000000000000000000000000000000000000000000000604082015260600190565b601a81527f63616e63656c20636f6d6d756e69747920746f6f206f6674656e000000000000602082015260400190565b601e81527f7461726765742061646472657373206e6f74206120636f6d6d756e6974790000602082015260400190565b601881527f61646472657373206d757374206265206973206c696768740000000000000000602082015260400190565b602281527f63616e63656c20766f7465206d757374206265206c65737320796f757220766f60208201527f7465000000000000000000000000000000000000000000000000000000000000604082015260600190565b600f81527f706172616d732069732077726f6e670000000000000000000000000000000000602082015260400190565b601281527f726174652073657474696e67206572726f720000000000000000000000000000602082015260400190565b6000815260200190565b601181527f617574686f7269736564206661696c6564000000000000000000000000000000602082015260400190565b602581527f61646472657373206d757374206265206973206c69676874206f7220636f6d6d60208201527f756e697479000000000000000000000000000000000000000000000000000000604082015260600190565b601181527f6164647265737320206973206c69676874000000000000000000000000000000602082015260400190565b805160009060c0840190614a8d858261413e565b506020830151614aa0602086018261413e565b506040830151614ab36040860182614ccd565b5060608301518482036060860152614acb828261437b565b9150506080830151614ae06080860182614ccd565b5060a0830151614af360a0860182614ccd565b509392505050565b8051600090610120840190614b10858261413e565b506020830151614b23602086018261413e565b506040830151614b366040860182614ccd565b5060608301518482036060860152614b4e828261437b565b9150506080830151614b636080860182614ccd565b5060a0830151614b7660a0860182614ccd565b5060c0830151614b8960c0860182614ccd565b5060e0830151614b9c60e0860182614cdf565b50610100830151614af3610100860182614ccd565b805160009060e0840190614bc5858261413e565b506020830151614bd8602086018261413e565b506040830151614beb6040860182614ccd565b506060830151614bfe6060860182614ccd565b5060808301518482036080860152614c16828261437b565b91505060a0830151614c2b60a0860182614ccd565b5060c083015184820360c0860152614c43828261437b565b95945050505050565b805160009060c0840190614c60858261413e565b506020830151614c73602086018261413e565b506040830151614c866040860182614cdf565b506060830151614c996060860182614ccd565b506080830151614cac6080860182614ccd565b5060a083015184820360a0860152614c43828261420f565b614147816150b1565b61414781610ad1565b614147816150b8565b614147816150c1565b60208101612e3b828461413e565b60a08101614d04828861413e565b614d11602083018761413e565b614d1e6040830186614ccd565b614d2b6060830185614ccd565b8181036080830152614d3d818461437b565b979650505050505050565b60208082528101610f48818461414d565b60208082528101610f4881846141b4565b60208082528101610f48818461426a565b60408082528101614d8c818561431c565b90508181036020830152613f6781846142c5565b60208101612e3b8284614369565b60208082528101612e3b8161442f565b60208082528101612e3b8161445f565b60208082528101612e3b816144b5565b60208082528101612e3b816144e5565b60208082528101612e3b81614515565b60208082528101612e3b8161456b565b60208082528101612e3b816145c1565b60208082528101612e3b816145f1565b60208082528101612e3b81614647565b60208082528101612e3b81614677565b60208082528101612e3b816146cd565b60208082528101612e3b816146fd565b60208082528101612e3b8161472d565b60208082528101612e3b8161475d565b60208082528101612e3b8161478d565b60208082528101612e3b816147bd565b60208082528101612e3b816147ed565b60208082528101612e3b8161481d565b60208082528101612e3b81614873565b60208082528101612e3b816148a3565b60208082528101612e3b816148d3565b60208082528101612e3b81614903565b60208082528101612e3b81614959565b60208082528101612e3b81614989565b60208082528101612e3b816149c3565b60208082528101612e3b816149f3565b60208082528101612e3b81614a49565b60208082528101610f488184614c4c565b60208101612e3b8284614cc4565b60208101612e3b8284614ccd565b60608101614f998286614ccd565b8181036020830152614fab81856143b0565b9050613f676040830184614372565b60608101614fc88285614ccd565b8181036020830152614fd9816149b9565b9050610f486040830184614372565b60408101614ff68285614ccd565b610f486020830184614ccd565b60208101612e3b8284614cd6565b60208101612e3b8284614cdf565b60405181810167ffffffffffffffff8111828210171561503e57600080fd5b604052919050565b600067ffffffffffffffff82111561505d57600080fd5b5060209081020190565b600067ffffffffffffffff82111561507e57600080fd5b506020601f91909101601f19160190565b60200190565b60009081526020902090565b5190565b600160a060020a031690565b61ffff1690565b63ffffffff1690565b60ff1690565b6000612e3b82610ad1565b6000612e3b826150c1565b82818337506000910152565b60005b838110156151045781810151838201526020016150ec565b838111156122fb5750506000910152565b601f01601f1916905600a265627a7a72305820bdb8e1bf45fc950b19e139be29f5d1fa9fca4d4aefb4f6c85389c6510c81ea826c6578706572696d656e74616cf50037`
)

const (
	ADD_COMMUNITY_ID        = "5d7871ba"
	DEL_COMMUNITY_ID        = "d8593433"
	ADD_VOTE_ID             = "6cea0e46"
	DEL_VOTE_ID             = "9351f4f2"
	ADD_LIGHT_ID            = "c9fd650d"
	DEL_LIGHT_ID            = "9fe8326a"
	WITH_DRAWC_ID           = "0c0d831d"
	WITH_DRAWL_ID           = "64ab6c69"
	WITH_DRAWW_ID           = "5a9499e0"
	COMMUNITY_DISTRIBUTE_ID = "96a9fd72"
	DOMAIN_REGISTER_ID      = "8acf0a70"
	DOMAIN_RENEW_ID         = "acf1a841"
	DOMAIN_WITH_DRAW_ID     = "3ccfd60b"
	SET_RATE                = "4afe2f80"
	TRANSFER_ERC20          = "a9059cbb"
	TRANSFER_ERC20_FROM     = "23b872dd"
	L1_L2_TRANSFER          = "439370b1"
	L2_L1_WITH_DRAW         = "cf0d9098"
)

var RewardContract crypto.AddressCoin
var CloudStorageProxyContract crypto.AddressCoin
var DomainRegisterContract crypto.AddressCoin

func InitRewardContract() {
	RewardContract = evmutils.AddressToAddressCoin(common.HexToAddress(config.RewardContractAddr).Bytes())
	CloudStorageProxyContract = evmutils.AddressToAddressCoin(common.HexToAddress(config.CloudStorageProxyContractAddr).Bytes())
	DomainRegisterContract = evmutils.AddressToAddressCoin(common.HexToAddress(config.BASE_REGISTAR_ADDR).Bytes())
}

func InitRewardContractToLight(str string) {
	config.AddrPre = str
	RewardContract = evmutils.AddressToAddressCoin(common.HexToAddress(config.RewardContractAddr).Bytes())
}

type Community struct {
	Addr        common.Address
	Wit         common.Address
	Vote        *big.Int
	Name        string
	Score       *big.Int
	BlockHeight *big.Int
	Ratio       uint32
}
type CommunityReward struct {
	Addr        common.Address
	Wit         common.Address
	Vote        *big.Int
	Name        string
	Score       *big.Int
	BlockHeight *big.Int
	Reward      *big.Int
	Rate        uint8
	LightCount  *big.Int
}

type CommunityRewardSort []CommunityReward

func (c CommunityRewardSort) Len() int {
	return len(c)
}

func (c CommunityRewardSort) Less(i, j int) bool {
	return c[i].Vote.Uint64() > c[j].Vote.Uint64()
}

func (c CommunityRewardSort) Swap(i, j int) {
	c[i], c[j] = c[j], c[i]
}

type WitnessDetail struct {
	Addr         common.Address
	Wit          common.Address
	Rate         uint8
	Reward       *big.Int
	RemainReward *big.Int
	Communitys   []CommunityReward
}
type Light struct {
	Addr        common.Address
	C           common.Address
	Vote        *big.Int
	Score       *big.Int
	Cname       string
	BlockHeight *big.Int
	Name        string
	Ratio       uint32
}

type LogRewardHistory struct {
	Into   common.Address
	From   common.Address
	Reward *big.Int
	Name   string
	Utype  uint8
}

type LogRewardHistoryV0 struct {
	Into   string
	From   string
	Reward *big.Int
	Name   string
	Utype  uint8
}

type LogEnsHistory struct {
	From   common.Address
	To     common.Address
	Amount *big.Int
}

type LogEnsHistoryV0 struct {
	Into   string
	From   string
	Amount *big.Int
}

type LogEventBlockRewardLogRewardHistory struct {
	Into   common.Address
	From   common.Address
	Reward *big.Int
}

type LogCommunityRewardPool struct {
	Community common.Address
	Reward    *big.Int
}

func SetRate(from crypto.AddressCoin, rate uint16) {
	engine.Log.Info("设置比例")
	block := new(environment.Block)
	var (
		evmErr error
		result vm.ExecuteResult
	)
	engine.Log.Info("719 %s", RewardContract.B58String())
	vmRun := evm.NewVmRun(from, RewardContract, []byte("0x1"), block)
	vmRun.SetStorage(RewardContract)

	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	//创建合约，提前构建相应结构
	input, _ := abiObj.Pack("setRate", uint8(rate))
	result, _, evmErr = evm.Run(input, 100000, 1, 0, false, vmRun)
	//result, _, evmErr = vmRun.Run(input, 100000, 1, 0, false)
	isSuccess := true
	if evmErr != nil {
		isSuccess = false
		engine.Log.Info("见证人保存比例失败%s", evmErr.Error())
	}
	if result.ExitOpCode == opcodes.REVERT {
		isSuccess = false
		engine.Log.Info("见证人保存比例异常退出,revert")
	}
	if isSuccess {
		// 合约执行成功,缓存全局合约对象
		vmRun.CacheStorage(RewardContract)
	}
}

// 添加社区节点
func AddCommunity(witness, community crypto.AddressCoin, vote *big.Int, rate uint16) {
	block := new(environment.Block)
	var (
		evmErr error
		result vm.ExecuteResult
	)
	vmRun := evm.NewVmRun(community, RewardContract, []byte("0x1"), block)
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	//创建合约，提前构建相应结构
	input, _ := abiObj.Pack("addCommunity",
		common.Address(evmutils.AddressCoinToAddress(witness)),
		common.Address(evmutils.AddressCoinToAddress(community)),
		vote,
		uint8(rate),
	)
	result, _, evmErr = vmRun.Run(input, 100000, 1, 0, false)
	if evmErr != nil {
		engine.Log.Info("添加社区节点失败%s", evmErr.Error())
	}
	if result.ExitOpCode == opcodes.REVERT {
		engine.Log.Info("添加社区节点异常退出,revert")
	}
}

// 删除社区节点
func DelCommunity(witness, community crypto.AddressCoin) {
	block := new(environment.Block)
	var (
		evmErr error
		result vm.ExecuteResult
	)
	vmRun := evm.NewVmRun(community, RewardContract, []byte("0x1"), block)
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("delCommunity",
		common.Address(evmutils.AddressCoinToAddress(witness)),
		common.Address(evmutils.AddressCoinToAddress(community)),
	)
	result, _, evmErr = vmRun.Run(input, 100000, 1, 0, false)
	if evmErr != nil {
		engine.Log.Info("移除社区节点失败%s", evmErr.Error())
	}
	if result.ExitOpCode == opcodes.REVERT {
		engine.Log.Info("移除社区节点异常退出,revert")
	}
}

// 添加投票
func AddVote(community, light crypto.AddressCoin, vote *big.Int) {
	block := new(environment.Block)
	var (
		evmErr error
		result vm.ExecuteResult
	)
	vmRun := evm.NewVmRun(light, RewardContract, []byte("0x1"), block)
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("addVote",
		common.Address(evmutils.AddressCoinToAddress(community)),
		common.Address(evmutils.AddressCoinToAddress(light)),
		vote,
	)
	result, _, evmErr = vmRun.Run(input, 100000, 1, 0, false)
	if evmErr != nil {
		engine.Log.Info("添加轻节点投票失败%s", evmErr.Error())
	}
	if result.ExitOpCode == opcodes.REVERT {
		engine.Log.Info("添加轻节点投票异常退出,revert")
	}
}

// 删除投票
func DelVote(light crypto.AddressCoin) {
	block := new(environment.Block)
	var (
		evmErr error
		result vm.ExecuteResult
	)
	vmRun := evm.NewVmRun(light, RewardContract, []byte("0x1"), block)
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("delVote",
		common.Address(evmutils.AddressCoinToAddress(light)),
	)
	result, _, evmErr = vmRun.Run(input, 100000, 1, 0, false)
	if evmErr != nil {
		engine.Log.Info("移除轻节点投票失败%s", evmErr.Error())
	}
	if result.ExitOpCode == opcodes.REVERT {
		engine.Log.Info("移除轻节点投票异常退出,revert")
	}
}

// 构造分发奖励输入
func BuildDistributeInput(list []*crypto.AddressCoin, index, totalReward uint64) []byte {
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	witnessList := []common.Address{}
	for _, v := range list {
		witnessList = append(witnessList, common.Address(evmutils.AddressCoinToAddress(*v)))
	}
	input, _ := abiObj.Pack("distribute", witnessList, big.NewInt(int64(index)), big.NewInt(int64(totalReward)))
	return input
}

// 构造社区节点质押输入
func BuildAddCommunityInput(witness crypto.AddressCoin, rate uint16, name string) []byte {
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("addCommunity",
		common.Address(evmutils.AddressCoinToAddress(witness)),
		uint8(rate),
		name,
	)
	return input
}

// 构造轻节点投票输入
func BuildAddVoteInput(community crypto.AddressCoin) []byte {
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("addVote",
		common.Address(evmutils.AddressCoinToAddress(community)),
	)
	return input
}

// 构造轻节点添加输入
func BuildAddLightInput(name string) []byte {
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("addLight", name)
	return input
}
func BuildDelCommunity() []byte {
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("delCommunity")
	return input
}
func BuildDelVote(vote *big.Int) []byte {
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("delVote", vote)
	return input
}
func BuildDelLight() []byte {
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("delLight")
	return input
}
func GetAddrState(from, addr crypto.AddressCoin) uint64 {
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("getAddrState", common.Address(evmutils.AddressCoinToAddress(addr)))

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.(uint64); ok {
	//		return out
	//	}
	//}

	vmRun := evm.NewVmRun(from, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return 0
	}
	out, err := abiObj.Unpack("getAddrState", result.ResultData)
	if err != nil {
		return 0
	}
	out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)

	//LightCache:更新轻节点缓存数据
	//lightcache.SetCache(input, out0.Uint64())

	return out0.Uint64()
}

// 获取所有社区节点
func GetAllCommunity(from crypto.AddressCoin) []Community {
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("getAllCommunity")

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.([]Community); ok {
	//		return out
	//	}
	//}

	vmRun := evm.NewVmRun(from, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return []Community{}
	}
	out, err := abiObj.Unpack("getAllCommunity", result.ResultData)
	if err != nil {
		return []Community{}
	}
	out0 := *abi.ConvertType(out[0], new([]Community)).(*[]Community)
	resList := []Community{}
	for _, v := range out0 {
		if v.Addr != evmutils.ZeroAddress {
			resList = append(resList, v)
		}
	}

	//LightCache:更新轻节点缓存数据
	//lightcache.SetCache(input, resList)

	return resList
}

// 获取所有社区节点(包含奖励）
func GetAllCommunityReward(from crypto.AddressCoin) []CommunityReward {
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("getCommunityRewardList")

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.([]CommunityReward); ok {
	//		return out
	//	}
	//}

	vmRun := evm.NewVmRun(from, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 90000000, 1, 0, false)
	if err != nil {
		return []CommunityReward{}
	}
	out, err := abiObj.Unpack("getCommunityRewardList", result.ResultData)
	if err != nil {
		return []CommunityReward{}
	}
	out0 := *abi.ConvertType(out[0], new([]CommunityReward)).(*[]CommunityReward)
	resList := []CommunityReward{}
	for _, v := range out0 {
		if v.Addr != evmutils.ZeroAddress {
			resList = append(resList, v)
		}
	}

	//LightCache:更新轻节点缓存数据
	//lightcache.SetCache(input, resList)

	return resList
}

// 获取节点奖励比例
func GetRewardRatio(from crypto.AddressCoin) (uint8, error) {
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("getRate")

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.(uint8); ok {
	//		return out, nil
	//	}
	//}

	vmRun := evm.NewVmRun(from, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return 0, err
	}
	out, err := abiObj.Unpack("getRate", result.ResultData)
	if err != nil {
		return 0, err
	}
	out0 := *abi.ConvertType(out[0], new(uint8)).(*uint8)

	//LightCache:更新轻节点缓存数据
	//lightcache.SetCache(input, out0)

	return out0, err
}

// 根据地址列表获取社区节点情况
func GetCommunityList(list []crypto.AddressCoin) []Community {
	newList := []common.Address{}
	for _, v := range list {
		addr := common.Address(evmutils.AddressCoinToAddress(v))
		newList = append(newList, addr)
	}
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))

	input, _ := abiObj.Pack("getCommunityList", newList)

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.([]Community); ok {
	//		return out
	//	}
	//}

	vmRun := evm.NewVmRun(list[0], RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return []Community{}
	}
	out, err := abiObj.Unpack("getCommunityList", result.ResultData)
	if err != nil {
		return []Community{}
	}
	out0 := *abi.ConvertType(out[0], new([]Community)).(*[]Community)
	resList := []Community{}
	for _, v := range out0 {
		if v.Addr != evmutils.ZeroAddress {
			resList = append(resList, v)
		}
	}

	//LightCache:更新轻节点缓存数据
	//lightcache.SetCache(input, resList)

	return resList
}

// 根据地址列表获取轻节点信息
func GetLightList(list []crypto.AddressCoin) []Light {
	newList := []common.Address{}
	for _, v := range list {
		addr := common.Address(evmutils.AddressCoinToAddress(v))
		newList = append(newList, addr)
	}
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("getLightList", newList)

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.([]Light); ok {
	//		return out
	//	}
	//}

	vmRun := evm.NewVmRun(list[0], RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return []Light{}
	}
	out, err := abiObj.Unpack("getLightList", result.ResultData)
	if err != nil {
		return []Light{}
	}
	out0 := *abi.ConvertType(out[0], new([]Light)).(*[]Light)
	resList := []Light{}
	for _, v := range out0 {
		if v.Addr != evmutils.ZeroAddress {
			resList = append(resList, v)
		}
	}

	//LightCache:更新轻节点缓存数据
	//lightcache.SetCache(input, resList)

	return resList
}

// 根据地址获取轻节点奖励
func GetNodeReward(address crypto.AddressCoin) uint64 {
	addr := common.Address(evmutils.AddressCoinToAddress(address))
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("queryAllReward", addr)

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.(uint64); ok {
	//		return out
	//	}
	//}

	vmRun := evm.NewVmRun(address, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return 0
	}
	out, err := abiObj.Unpack("queryAllReward", result.ResultData)
	if err != nil {
		return 0
	}
	out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)

	//LightCache:更新轻节点缓存数据
	//lightcache.SetCache(input, out0.Uint64())

	return out0.Uint64()
}

// 查询某见证人下属的社区节点列表
func GetCommunityListByWit(addr crypto.AddressCoin) []Community {
	witness := common.Address(evmutils.AddressCoinToAddress(addr))

	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))

	input, _ := abiObj.Pack("getCommunityListByWit", witness)

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.([]Community); ok {
	//		return out
	//	}
	//}

	vmRun := evm.NewVmRun(addr, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return []Community{}
	}
	out, err := abiObj.Unpack("getCommunityListByWit", result.ResultData)
	if err != nil {
		return []Community{}
	}
	out0 := *abi.ConvertType(out[0], new([]Community)).(*[]Community)
	resList := []Community{}
	for _, v := range out0 {
		if v.Addr != evmutils.ZeroAddress {
			resList = append(resList, v)
		}
	}

	//LightCache:更新轻节点缓存数据
	//lightcache.SetCache(input, resList)

	return resList
}

// 查询社区节点下面的轻节点投票
func GetLightListByC(addr crypto.AddressCoin) []Light {
	community := common.Address(evmutils.AddressCoinToAddress(addr))
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("getLightListByC", community)

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.([]Light); ok {
	//		return out
	//	}
	//}

	vmRun := evm.NewVmRun(addr, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return []Light{}
	}
	out, err := abiObj.Unpack("getLightListByC", result.ResultData)
	if err != nil {
		return []Light{}
	}
	out0 := *abi.ConvertType(out[0], new([]Light)).(*[]Light)
	resList := []Light{}
	for _, v := range out0 {
		if v.Addr != evmutils.ZeroAddress {
			resList = append(resList, v)
		}
	}

	//LightCache:更新轻节点缓存数据
	//lightcache.SetCache(input, resList)

	return resList
}

// 获取我未提现的奖励
func GetMyFrozenReward(addr crypto.AddressCoin) uint64 {
	rewardAddr := common.Address(evmutils.AddressCoinToAddress(addr))
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("remainReward", rewardAddr)

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.(uint64); ok {
	//		return out
	//	}
	//}

	vmRun := evm.NewVmRun(addr, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return 0
	}
	out, err := abiObj.Unpack("remainReward", result.ResultData)
	if err != nil {
		return 0
	}
	out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)

	//LightCache:更新轻节点缓存数据
	//lightcache.SetCache(input, out0.Uint64())

	return out0.Uint64()
}

// 获取我未提现的社区节点奖励
func GetMyCommunityFrozenReward(addr crypto.AddressCoin) uint64 {
	rewardAddr := common.Address(evmutils.AddressCoinToAddress(addr))
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("remainCReward", rewardAddr)
	vmRun := evm.NewVmRun(addr, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return 0
	}
	out, err := abiObj.Unpack("remainCReward", result.ResultData)
	if err != nil {
		return 0
	}
	out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)
	return out0.Uint64()
}

// 获取我未提现的轻节点奖励
func GetMyLightFrozenReward(addr crypto.AddressCoin) uint64 {
	rewardAddr := common.Address(evmutils.AddressCoinToAddress(addr))
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("remainLReward", rewardAddr)
	vmRun := evm.NewVmRun(addr, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return 0
	}
	out, err := abiObj.Unpack("remainLReward", result.ResultData)
	if err != nil {
		return 0
	}
	out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)
	return out0.Uint64()
}

// 获取所有轻节点---有待商榷
func GetAllLight(from crypto.AddressCoin, start, end *big.Int) []Light {
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("getAllLight", start, end)

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.([]Light); ok {
	//		return out
	//	}
	//}

	vmRun := evm.NewVmRun(from, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return []Light{}
	}
	out, err := abiObj.Unpack("getAllLight", result.ResultData)
	if err != nil {
		return []Light{}
	}
	out0 := *abi.ConvertType(out[0], new([]Light)).(*[]Light)
	resList := []Light{}
	for _, v := range out0 {
		if v.Addr != evmutils.ZeroAddress {
			resList = append(resList, v)
		}
	}

	//LightCache:更新轻节点缓存数据
	//lightcache.SetCache(input, resList)

	return resList
}

// 获取我的质押
func GetMyDeposit(addr crypto.AddressCoin) uint64 {
	depositAddr := common.Address(evmutils.AddressCoinToAddress(addr))
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("deposit", depositAddr)
	vmRun := evm.NewVmRun(addr, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return 0
	}
	out, err := abiObj.Unpack("deposit", result.ResultData)
	if err != nil {
		return 0
	}
	out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)
	return out0.Uint64()
}

// 获取见证者节点投票
func GetWitnessVote(addr crypto.AddressCoin) uint64 {
	witnessAddr := common.Address(evmutils.AddressCoinToAddress(addr))
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("getWiteVote", witnessAddr)

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.(uint64); ok {
	//		return out
	//	}
	//}

	vmRun := evm.NewVmRun(addr, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return 0
	}
	out, err := abiObj.Unpack("getWiteVote", result.ResultData)
	if err != nil {
		return 0
	}
	out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)

	//LightCache:更新轻节点缓存数据
	//lightcache.SetCache(input, out0.Uint64())

	return out0.Uint64()
}

// 构造社区向轻节点分账奖励
func BuildCommunityDistributeInput() []byte {
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("communityDistribute")
	return input
}

// 构造云存储代理奖励
func BuildCloudStorageProxyRewardInput() []byte {
	abiObj, _ := abi.JSON(strings.NewReader(cloud.CLOUD_PROXY_ABI))
	input, _ := abiObj.Pack("resetVerify")
	return input
}

// 构造提现奖励输入
func BuildWithDrawRewardInput(value *big.Int, drawType uint64) []byte {
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	var input []byte
	//社区节点提现
	if drawType == 1 {
		input, _ = abiObj.Pack("withDrawC", value)
	} else if drawType == 2 {
		input, _ = abiObj.Pack("withDrawL", value)
	} else {
		input, _ = abiObj.Pack("withDrawW", value)
	}

	return input
}

func UnPackLogRewardHistoryLog(contractEventInfo *go_protos.ContractEventInfo) LogRewardHistory {
	var log LogRewardHistory
	UnpackLog(&log, "LogRewardHistory", contractEventInfo)
	return log
}

func UnPackLogEnsHistoryLog(contractEventInfo *go_protos.ContractEventInfo) LogEnsHistory {
	var log LogEnsHistory
	UnpackEnsLog(&log, "Withdraw", contractEventInfo)
	return log
}

func UnPackLogCommunityRewardPool(contractEventInfo *go_protos.ContractEventInfo) LogCommunityRewardPool {
	var log LogCommunityRewardPool
	UnpackLog(&log, "LogCommunityRewardPool", contractEventInfo)
	return log
}

func UnpackLog(out interface{}, event string, contractEventInfo *go_protos.ContractEventInfo) error {
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	if contractEventInfo.Topic != common.Bytes2Hex(abiObj.Events[event].ID.Bytes()) {
		return errors.New("事件签名不符")
	}
	eventData := contractEventInfo.EventData
	logData := eventData[len(eventData)-1]
	//if log.Topics[0] != _BlockReward.abi.Events[event].ID {
	//	return fmt.Errorf("event signature mismatch")
	//}
	if logData != "" {
		if err := abiObj.UnpackIntoInterface(out, event, common.Hex2Bytes(logData)); err != nil {
			return err
		}
	}
	var indexed abi.Arguments
	for _, arg := range abiObj.Events[event].Inputs {
		if arg.Indexed {
			indexed = append(indexed, arg)
		}
	}
	//去除掉第一个主题
	topics := []common.Hash{}
	for i := 0; i < len(eventData)-1; i++ {
		topics = append(topics, common.BytesToHash(common.Hex2Bytes(eventData[i])))
	}
	return abi.ParseTopics(out, indexed, topics)
}

func UnpackEnsLog(out interface{}, event string, contractEventInfo *go_protos.ContractEventInfo) error {
	abiObj, _ := abi.JSON(strings.NewReader(ens.REGISTRAR_ABI))
	if contractEventInfo.Topic != common.Bytes2Hex(abiObj.Events[event].ID.Bytes()) {
		return errors.New("事件签名不符")
	}
	eventData := contractEventInfo.EventData
	logData := eventData[len(eventData)-1]
	//if log.Topics[0] != _BlockReward.abi.Events[event].ID {
	//	return fmt.Errorf("event signature mismatch")
	//}
	if logData != "" {
		if err := abiObj.UnpackIntoInterface(out, event, common.Hex2Bytes(logData)); err != nil {
			return err
		}
	}
	var indexed abi.Arguments
	for _, arg := range abiObj.Events[event].Inputs {
		if arg.Indexed {
			indexed = append(indexed, arg)
		}
	}
	//去除掉第一个主题
	topics := []common.Hash{}
	for i := 0; i < len(eventData)-1; i++ {
		topics = append(topics, common.BytesToHash(common.Hex2Bytes(eventData[i])))
	}
	return abi.ParseTopics(out, indexed, topics)
}

// 获取奖励记录历史
func GetRewardHistoryLog(height uint64, txhash []byte) []LogRewardHistoryV0 {
	histories := []LogRewardHistoryV0{}
	key := append([]byte(config.DBKEY_BLOCK_EVENT), big.NewInt(int64(height)).Bytes()...)
	listBytes, err := db.LevelDB.GetDB().HGet(key, txhash)
	if err != nil {
		return histories
	}
	list := go_protos.ContractEventInfoList{}
	err = proto.Unmarshal(listBytes, &list)
	if err != nil {
		return histories
	}
	for _, v := range list.GetContractEvents() {
		historyLog := UnPackLogRewardHistoryLog(v)
		into := evmutils.AddressToAddressCoin(historyLog.Into.Bytes())
		var fromAddr string
		if historyLog.From == evmutils.ZeroAddress {
			fromAddr = ""
		} else {
			from := evmutils.AddressToAddressCoin(historyLog.From.Bytes())
			fromAddr = from.B58String()
		}

		if historyLog.Reward == nil || historyLog.Reward == new(big.Int) {
			historyLog.Reward = big.NewInt(0)
		}
		histories = append(histories, LogRewardHistoryV0{
			Into:   into.B58String(),
			From:   fromAddr,
			Reward: historyLog.Reward,
			Name:   historyLog.Name,
			Utype:  historyLog.Utype,
		})
	}
	return histories
}

// 获取域名交易记录历史
func GetEnsHistoryLog(height uint64, txhash []byte) []LogEnsHistoryV0 {
	histories := []LogEnsHistoryV0{}
	key := append([]byte(config.DBKEY_BLOCK_EVENT), big.NewInt(int64(height)).Bytes()...)
	listBytes, err := db.LevelDB.GetDB().HGet(key, txhash)
	if err != nil {
		return histories
	}
	list := go_protos.ContractEventInfoList{}
	err = proto.Unmarshal(listBytes, &list)
	if err != nil {
		return histories
	}
	for _, v := range list.GetContractEvents() {
		historyLog := UnPackLogEnsHistoryLog(v)
		into := evmutils.AddressToAddressCoin(historyLog.To.Bytes())
		var fromAddr string
		if historyLog.From == evmutils.ZeroAddress {
			fromAddr = ""
		} else {
			from := evmutils.AddressToAddressCoin(historyLog.From.Bytes())
			fromAddr = from.B58String()
		}

		if historyLog.Amount == nil || historyLog.Amount == new(big.Int) {
			historyLog.Amount = big.NewInt(0)
		}
		histories = append(histories, LogEnsHistoryV0{
			Into:   into.B58String(),
			From:   fromAddr,
			Amount: historyLog.Amount,
		})
	}
	return histories
}

// //交易类型对应函数 社区节点质押-
// //根据函数签名获取交易类型
//
//	func GetTxClassByMethodSign() {
//		classMap := make(map[string]int)
//
// }
func UnpackPayload(payload []byte) (uint64, uint64) {
	if len(payload) < 8 {
		return 0, 0
	}

	payloadHex := common.Bytes2Hex(payload)
	//payloadHex = "14174f3300000000000000000000000000000000000000000000000000000000720affaf"
	//payload = common.Hex2Bytes(payloadHex)
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	//fmt.Println(common.Bytes2Hex(abiObj.Methods["distribute"].ID)) 5a9499e0
	//return 0, 0
	methodId := payloadHex[:8]
	switch methodId {
	case ADD_COMMUNITY_ID:
		return config.Wallet_tx_type_community_in, 0
	//社区节点质押
	case DEL_COMMUNITY_ID:
		return config.Wallet_tx_type_community_out, 0
	case ADD_VOTE_ID:
		return config.Wallet_tx_type_vote_in, 0
	case DEL_VOTE_ID:
		out, _ := abiObj.Methods["delVote"].Inputs.Unpack(payload[4:])
		out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)
		return config.Wallet_tx_type_vote_out, out0.Uint64()
	case ADD_LIGHT_ID:
		return config.Wallet_tx_type_light_in, 0
	case DEL_LIGHT_ID:
		return config.Wallet_tx_type_light_out, 0
	case WITH_DRAWC_ID:
		out, _ := abiObj.Methods["withDrawC"].Inputs.Unpack(payload[4:])
		out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)
		return config.Wallet_tx_type_reward_C, out0.Uint64()
	case WITH_DRAWL_ID:
		out, _ := abiObj.Methods["withDrawL"].Inputs.Unpack(payload[4:])
		out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)
		return config.Wallet_tx_type_reward_L, out0.Uint64()
	case WITH_DRAWW_ID:
		out, _ := abiObj.Methods["withDrawW"].Inputs.Unpack(payload[4:])
		out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)
		return config.Wallet_tx_type_reward_W, out0.Uint64()
	case COMMUNITY_DISTRIBUTE_ID: // 社区分账包含社区和轻节点提取奖励,因此 WITH_DRAWC_ID,WITH_DRAWL_ID 废弃了
		return config.Wallet_tx_type_community_distribute, 0
	case DOMAIN_REGISTER_ID:
		return config.Wallet_tx_type_domain_register, 0
	case DOMAIN_RENEW_ID:
		return config.Wallet_tx_type_domain_renew, 0
	case DOMAIN_WITH_DRAW_ID:
		return config.Wallet_tx_type_domain_withdraw, 0
	case L1_L2_TRANSFER: // 跨链l1到l2转账
		return config.Wallet_tx_type_l1_l2_transfer, 0
	case L2_L1_WITH_DRAW: // 跨链l2到l1提现
		return config.Wallet_tx_type_l2_l1_withdraw, 0

	default:
		return 0, 0
	}
}

func UnpackCustomPayload(payload []byte) (uint64, string, uint64) {
	if len(payload) < 8 {
		return 0, "", 0
	}

	payloadHex := common.Bytes2Hex(payload)
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	methodId := payloadHex[:8]
	switch methodId {
	case ADD_COMMUNITY_ID:
		return config.Wallet_tx_type_community_in, "", 0
	//社区节点质押
	case DEL_COMMUNITY_ID:
		return config.Wallet_tx_type_community_out, "", 0
	case ADD_VOTE_ID:
		return config.Wallet_tx_type_vote_in, "", 0
	case DEL_VOTE_ID:
		out, _ := abiObj.Methods["delVote"].Inputs.Unpack(payload[4:])
		out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)
		return config.Wallet_tx_type_vote_out, "", out0.Uint64()
	case ADD_LIGHT_ID:
		return config.Wallet_tx_type_light_in, "", 0
	case DEL_LIGHT_ID:
		return config.Wallet_tx_type_light_out, "", 0
	case WITH_DRAWC_ID:
		out, _ := abiObj.Methods["withDrawC"].Inputs.Unpack(payload[4:])
		out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)
		return config.Wallet_tx_type_reward_C, "", out0.Uint64()
	case WITH_DRAWL_ID:
		out, _ := abiObj.Methods["withDrawL"].Inputs.Unpack(payload[4:])
		out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)
		return config.Wallet_tx_type_reward_L, "", out0.Uint64()
	case WITH_DRAWW_ID:
		out, _ := abiObj.Methods["withDrawW"].Inputs.Unpack(payload[4:])
		out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)
		return config.Wallet_tx_type_reward_W, "", out0.Uint64()
	case COMMUNITY_DISTRIBUTE_ID: // 社区分账包含社区和轻节点提取奖励,因此 WITH_DRAWC_ID,WITH_DRAWL_ID 废弃了
		return config.Wallet_tx_type_community_distribute, "", 0
	case DOMAIN_REGISTER_ID:
		return config.Wallet_tx_type_domain_register, "", 0
	case DOMAIN_RENEW_ID:
		return config.Wallet_tx_type_domain_renew, "", 0
	case DOMAIN_WITH_DRAW_ID:
		return config.Wallet_tx_type_domain_withdraw, "", 0
	case TRANSFER_ERC20:
		abiObj, _ := abi.JSON(strings.NewReader(ERC20_ABI))
		out, _ := abiObj.Methods["transfer"].Inputs.Unpack(payload[4:])
		out0 := *abi.ConvertType(out[0], new(common.Address)).(*common.Address)
		out1 := *abi.ConvertType(out[1], new(big.Int)).(*big.Int)
		toAddr := evmutils.AddressToAddressCoin(out0.Bytes())
		return config.Wallet_tx_type_contract, toAddr.B58String(), out1.Uint64()
	case L1_L2_TRANSFER: // 跨链l1到l2转账
		return config.Wallet_tx_type_l1_l2_transfer, "", 0
	case L2_L1_WITH_DRAW: // 跨链l2到l1提现
		abiObj, _ := abi.JSON(strings.NewReader(cross.OUTBOX_ABI))
		out, _ := abiObj.Methods["withdraw"].Inputs.Unpack(payload[4:])
		value := *abi.ConvertType(out[2], new(big.Int)).(*big.Int)
		return config.Wallet_tx_type_l2_l1_withdraw, "", value.Uint64()
	default:
		return 0, "", 0
	}
}

func UnpackEnsPayload(payload []byte) (uint64, uint64) {
	if len(payload) < 8 {
		return 0, 0
	}

	payloadHex := common.Bytes2Hex(payload)
	//abiObj, _ := abi.JSON(strings.NewReader(ens.ENS_ABI))
	methodId := payloadHex[:8]
	switch methodId {
	case DOMAIN_REGISTER_ID:
		return config.Wallet_tx_type_domain_register, 0
	case DOMAIN_RENEW_ID:
		return config.Wallet_tx_type_domain_renew, 0
	case DOMAIN_WITH_DRAW_ID:
		return config.Wallet_tx_type_domain_withdraw, 0
	default:
		return 0, 0
	}
}

// 跨链币转账
func UnpackL1L2Payload(payload []byte) (uint64, uint64) {
	if len(payload) < 8 {
		return 0, 0
	}

	payloadHex := common.Bytes2Hex(payload)
	methodId := payloadHex[:8]
	switch methodId {
	case L1_L2_TRANSFER:
		return config.Wallet_tx_type_l1_l2_transfer, 0
	case L2_L1_WITH_DRAW:
		abiObj, _ := abi.JSON(strings.NewReader(cross.OUTBOX_ABI))
		//input, _ := abiObj.Pack("withdraw", txHash, l2BlockHash, value)
		out, _ := abiObj.Methods["withdraw"].Inputs.Unpack(payload[4:])
		value := *abi.ConvertType(out[2], new(big.Int)).(*big.Int)
		return config.Wallet_tx_type_l2_l1_withdraw, value.Uint64()
	default:
		return 0, 0
	}
}

// 解析ERC20相关
func UnpackErc20Payload(payload []byte) (uint64, crypto.AddressCoin, uint64) {
	if len(payload) < 8 {
		return 0, nil, 0
	}

	payloadHex := common.Bytes2Hex(payload)
	abiObj, _ := abi.JSON(strings.NewReader(ERC20_ABI))
	methodId := payloadHex[:8]
	switch methodId {
	case TRANSFER_ERC20:
		out, _ := abiObj.Methods["transfer"].Inputs.Unpack(payload[4:])
		out0 := *abi.ConvertType(out[0], new(common.Address)).(*common.Address)
		out1 := *abi.ConvertType(out[1], new(big.Int)).(*big.Int)
		toAddr := evmutils.AddressToAddressCoin(out0.Bytes())
		return config.Wallet_tx_type_contract, toAddr, out1.Uint64()
	case TRANSFER_ERC20_FROM:
		out, _ := abiObj.Methods["transferFrom"].Inputs.Unpack(payload[4:])
		out1 := *abi.ConvertType(out[1], new(common.Address)).(*common.Address)
		out2 := *abi.ConvertType(out[2], new(big.Int)).(*big.Int)
		toAddr := evmutils.AddressToAddressCoin(out1.Bytes())
		return config.Wallet_tx_type_contract, toAddr, out2.Uint64()

	default:
		return 0, nil, 0
	}
}

// 根据地址获取社区节点奖励
func GetCommunityNodeReward(address crypto.AddressCoin) uint64 {
	addr := common.Address(evmutils.AddressCoinToAddress(address))
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("allCReward", addr)

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.(uint64); ok {
	//		return out
	//	}
	//}

	vmRun := evm.NewVmRun(address, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return 0
	}
	out, err := abiObj.Unpack("allCReward", result.ResultData)
	if err != nil {
		return 0
	}
	out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)

	//LightCache:更新轻节点缓存数据
	//lightcache.SetCache(input, out0.Uint64())

	return out0.Uint64()
}

// 根据地址获取轻节点奖励
func GetLightNodeReward(address crypto.AddressCoin) uint64 {
	addr := common.Address(evmutils.AddressCoinToAddress(address))
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("allLReward", addr)

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.(uint64); ok {
	//		return out
	//	}
	//}

	vmRun := evm.NewVmRun(address, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return 0
	}
	out, err := abiObj.Unpack("allLReward", result.ResultData)
	if err != nil {
		return 0
	}
	out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)

	//LightCache:更新轻节点缓存数据
	//lightcache.SetCache(input, out0.Uint64())

	return out0.Uint64()
}

// 根据地址获取见证人身份节点奖励
func GetWitNodeReward(address crypto.AddressCoin) uint64 {
	addr := common.Address(evmutils.AddressCoinToAddress(address))
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("allWReward", addr)

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.(uint64); ok {
	//		return out
	//	}
	//}

	vmRun := evm.NewVmRun(address, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return 0
	}
	out, err := abiObj.Unpack("allWReward", result.ResultData)
	if err != nil {
		return 0
	}
	out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)

	//LightCache:更新轻节点缓存数据
	//lightcache.SetCache(input, out0.Uint64())

	return out0.Uint64()
}

// 获取我未提现的见证人节点奖励
func GetMyWitFrozenReward(addr crypto.AddressCoin) uint64 {
	rewardAddr := common.Address(evmutils.AddressCoinToAddress(addr))
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("remainWReward", rewardAddr)

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.(uint64); ok {
	//		return out
	//	}
	//}

	vmRun := evm.NewVmRun(addr, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return 0
	}
	out, err := abiObj.Unpack("remainWReward", result.ResultData)
	if err != nil {
		return 0
	}
	out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)

	//LightCache:更新轻节点缓存数据
	//lightcache.SetCache(input, out0.Uint64())

	return out0.Uint64()
}

// vote_type,wit,isAdd
func UnpackPayloadV1(payload []byte) (uint16, crypto.AddressCoin, bool) {
	payloadHex := common.Bytes2Hex(payload)
	//payloadHex = "14174f3300000000000000000000000000000000000000000000000000000000720affaf"
	//payload = common.Hex2Bytes(payloadHex)
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	//fmt.Println(common.Bytes2Hex(abiObj.Methods["distribute"].ID)) 5a9499e0
	//return 0, 0
	methodId := payloadHex[:8]
	switch methodId {
	case ADD_COMMUNITY_ID:
		out, _ := abiObj.Methods["addCommunity"].Inputs.Unpack(payload[4:])
		out0 := *abi.ConvertType(out[0], new(common.Address)).(*common.Address)
		wit := evmutils.AddressToAddressCoin(out0.Bytes())
		return 1, wit, true
	//社区节点质押
	case DEL_COMMUNITY_ID:
		return 1, nil, false
	case ADD_VOTE_ID:
		out, _ := abiObj.Methods["addVote"].Inputs.Unpack(payload[4:])
		out0 := *abi.ConvertType(out[0], new(common.Address)).(*common.Address)
		wit := evmutils.AddressToAddressCoin(out0.Bytes())
		return 2, wit, true
	case DEL_VOTE_ID:
		return 2, nil, false
	case ADD_LIGHT_ID:
		return 3, nil, true
	case DEL_LIGHT_ID:
		return 3, nil, false
	default:
		return 0, nil, false
	}
}

// vote_type,wit,isAdd
func UnpackPayloadCommunityRate(payload []byte) (crypto.AddressCoin, uint16) {
	payloadHex := common.Bytes2Hex(payload)
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	methodId := payloadHex[:8]
	switch methodId {
	case ADD_COMMUNITY_ID:
		out, _ := abiObj.Methods["addCommunity"].Inputs.Unpack(payload[4:])
		out0 := *abi.ConvertType(out[0], new(common.Address)).(*common.Address)
		out1 := *abi.ConvertType(out[1], new(uint8)).(*uint8)
		commAddr := evmutils.AddressToAddressCoin(out0.Bytes())
		return commAddr, uint16(out1)
	}
	return nil, 0
}

// vote_type,wit,isAdd
func isWitnessScoreOrVoteChanged(payload []byte) bool {
	payloadHex := common.Bytes2Hex(payload)
	methodId := payloadHex[:8]
	switch methodId {
	case ADD_COMMUNITY_ID:
		return true
	//社区节点质押
	case DEL_COMMUNITY_ID:
		return true
	case ADD_VOTE_ID:
		return true
	case DEL_VOTE_ID:
		return true
	case ADD_LIGHT_ID:
		return true
	case DEL_LIGHT_ID:
		return true
	default:
		return false
	}
}

// 根据轻节点地址获取对应见证人
func GetWitByL(address crypto.AddressCoin) string {
	addr := common.Address(evmutils.AddressCoinToAddress(address))
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("getWitByL", addr)

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.(string); ok {
	//		return out
	//	}
	//}

	vmRun := evm.NewVmRun(address, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return ""
	}
	out, err := abiObj.Unpack("getWitByL", result.ResultData)
	if err != nil {
		return ""
	}
	out0 := *abi.ConvertType(out[0], new(common.Address)).(*common.Address)
	if out0 != evmutils.ZeroAddress {
		coin := evmutils.AddressToAddressCoin(out0.Bytes())
		//LightCache:更新轻节点缓存数据
		//lightcache.SetCache(input, coin.B58String())
		return coin.B58String()
	}
	return ""
}

// 根据社区节点地址获取对应见证人
func GetWitByC(address crypto.AddressCoin) string {
	addr := common.Address(evmutils.AddressCoinToAddress(address))
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("getWitByC", addr)

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.(string); ok {
	//		return out
	//	}
	//}

	vmRun := evm.NewVmRun(address, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return ""
	}
	out, err := abiObj.Unpack("getWitByC", result.ResultData)
	if err != nil {
		return ""
	}
	out0 := *abi.ConvertType(out[0], new(common.Address)).(*common.Address)
	if out0 != evmutils.ZeroAddress {
		coin := evmutils.AddressToAddressCoin(out0.Bytes())
		//LightCache:更新轻节点缓存数据
		//lightcache.SetCache(input, coin.B58String())
		return coin.B58String()
	}
	return ""
}

// 获取轻节点总数
func GetLightTotal(address crypto.AddressCoin) uint64 {
	//addr := common.Address(evmutils.AddressCoinToAddress(address))
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("getLightTotal")

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.(uint64); ok {
	//		return out
	//	}
	//}

	vmRun := evm.NewVmRun(address, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return 0
	}
	out, err := abiObj.Unpack("getLightTotal", result.ResultData)
	if err != nil {
		return 0
	}
	out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)

	//LightCache:更新轻节点缓存数据
	//lightcache.SetCache(input, out0.Uint64())

	return out0.Uint64()
}

func UnpackPayloadForCheck(payload []byte) (uint16, crypto.AddressCoin, *big.Int, bool) {
	payloadHex := common.Bytes2Hex(payload)
	//payloadHex = "14174f3300000000000000000000000000000000000000000000000000000000720affaf"
	//payload = common.Hex2Bytes(payloadHex)
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	//fmt.Println(common.Bytes2Hex(abiObj.Methods["distribute"].ID)) 5a9499e0
	//return 0, 0
	methodId := payloadHex[:8]
	switch methodId {
	case ADD_COMMUNITY_ID:
		out, _ := abiObj.Methods["addCommunity"].Inputs.Unpack(payload[4:])
		out0 := *abi.ConvertType(out[0], new(common.Address)).(*common.Address)
		wit := evmutils.AddressToAddressCoin(out0.Bytes())
		return 1, wit, big.NewInt(int64(config.Mining_vote)), true
	//社区节点质押
	case DEL_COMMUNITY_ID:
		return 1, nil, big.NewInt(int64(config.Mining_vote)), false
	case ADD_VOTE_ID:
		out, _ := abiObj.Methods["addVote"].Inputs.Unpack(payload[4:])
		out0 := *abi.ConvertType(out[0], new(common.Address)).(*common.Address)
		wit := evmutils.AddressToAddressCoin(out0.Bytes())
		return 2, wit, big.NewInt(0), true
	case DEL_VOTE_ID:
		out, _ := abiObj.Methods["delVote"].Inputs.Unpack(payload[4:])
		out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)
		return 2, nil, out0, false
	case ADD_LIGHT_ID:
		return 3, nil, big.NewInt(int64(config.Mining_light_min)), true
	case DEL_LIGHT_ID:
		return 3, nil, big.NewInt(int64(config.Mining_light_min)), false
	default:
		return 0, nil, big.NewInt(0), false
	}
}

// 获取轻节点详情
func GetLightDetail(addr crypto.AddressCoin) Light {
	list := GetLightList([]crypto.AddressCoin{addr})
	if len(list) > 0 {
		return list[0]
	}
	return Light{}
}

// 获取角色数量
func GetRoleTotal(address crypto.AddressCoin) (uint64, uint64) {
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("getRoleTotal")

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.(lightcache.CacheGetRoleTotal); ok {
	//		return out.CommunityCount, out.LightCount
	//	}
	//}

	vmRun := evm.NewVmRun(address, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return 0, 0
	}
	out, err := abiObj.Unpack("getRoleTotal", result.ResultData)
	if err != nil {
		return 0, 0
	}
	out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)
	out1 := *abi.ConvertType(out[1], new(*big.Int)).(**big.Int)

	//LightCache:更新轻节点缓存数据
	//lightcache.SetCache(input, lightcache.CacheGetRoleTotal{
	//	CommunityCount: out0.Uint64(),
	//	LightCount:     out0.Uint64(),
	//})

	return out0.Uint64(), out1.Uint64()
}

// 批量获取奖励比例
func GetRewardRatioAndVoteByAddrs(from crypto.AddressCoin, addrs []common.Address) ([]uint8, []*big.Int, error) {
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("getRateAndVoteByAddrs", addrs)

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.(lightcache.CacheGetRewardRatioAndVoteByAddrs); ok {
	//		return out.Rates, out.Votes, nil
	//	}
	//}

	vmRun := evm.NewVmRun(from, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return nil, nil, err
	}
	out, err := abiObj.Unpack("getRateAndVoteByAddrs", result.ResultData)
	if err != nil {
		return nil, nil, err
	}
	out0 := *abi.ConvertType(out[0], new([]uint8)).(*[]uint8)
	out1 := *abi.ConvertType(out[1], new([]*big.Int)).(*[]*big.Int)

	//LightCache:更新轻节点缓存数据
	//lightcache.SetCache(input, lightcache.CacheGetRewardRatioAndVoteByAddrs{
	//	Rates: out0,
	//	Votes: out1,
	//})

	return out0, out1, err
}

// 获取见证人以及见证人下社区节点信息
func GetWitnessDetail(from crypto.AddressCoin) (WitnessDetail, bool) {
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	fromAddr := common.Address(evmutils.AddressCoinToAddress(from))
	input, _ := abiObj.Pack("getWitnessInfo", fromAddr)

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.(WitnessDetail); ok {
	//		return out, true
	//	}
	//}

	vmRun := evm.NewVmRun(from, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return WitnessDetail{}, false
	}
	out, err := abiObj.Unpack("getWitnessInfo", result.ResultData)
	if err != nil {
		return WitnessDetail{}, false
	}
	out0 := *abi.ConvertType(out[0], new(WitnessDetail)).(*WitnessDetail)

	//LightCache:更新轻节点缓存数据
	//lightcache.SetCache(input, out0)

	return out0, true
}

// 获取社区奖励池
func GetCommunityRewardPool(addr crypto.AddressCoin) *big.Int {
	rewardAddr := common.Address(evmutils.AddressCoinToAddress(addr))
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	input, _ := abiObj.Pack("communityRewardPool", rewardAddr)

	//LightCache:读取轻节点缓存
	//if val, ok := lightcache.GetCache(input); ok {
	//	if out, ok := val.(*big.Int); ok {
	//		return out
	//	}
	//}

	vmRun := evm.NewVmRun(addr, RewardContract, []byte("0x1"), nil)
	result, _, err := vmRun.Run(input, 9000000, 1, 0, false)
	if err != nil {
		return big.NewInt(0)
	}
	out, err := abiObj.Unpack("communityRewardPool", result.ResultData)
	if err != nil {
		return big.NewInt(0)
	}
	out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)

	//LightCache:更新轻节点缓存数据
	//lightcache.SetCache(input, out0)

	return out0
}

func UnpackReward(payload []byte) (string, interface{}) {
	payloadHex := common.Bytes2Hex(payload)
	abiObj, _ := abi.JSON(strings.NewReader(REWARD_RATE_ABI))
	methodId := payloadHex[:8]
	switch methodId {
	case DEL_VOTE_ID:
		out, _ := abiObj.Methods["delVote"].Inputs.Unpack(payload[4:])
		out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)
		return DEL_VOTE_ID, out0.Uint64()
	case SET_RATE:
		out, _ := abiObj.Methods["setRate"].Inputs.Unpack(payload[4:])
		out0 := *abi.ConvertType(out[0], new(uint8)).(*uint8)
		return SET_RATE, out0
	default:
		return "", 0
	}
}
